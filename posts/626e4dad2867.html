<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Linux三剑客系列之awk | YYDS Space</title><meta name="keywords" content="Linux,三剑客,Linux三剑客,awk"><meta name="author" content="YYDS Space"><meta name="copyright" content="YYDS Space"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="准备工作🍉 本系列的awk教程中，将大量使用到如下示例文件a.txt。 1234567891011ID  name    gender  age  email          phone1   Bob     male    28   abc@qq.com     180233940122   Alice   female  24   def@gmail.com  180849252033">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux三剑客系列之awk">
<meta property="og:url" content="https://www.yyds.space/posts/626e4dad2867.html">
<meta property="og:site_name" content="YYDS Space">
<meta property="og:description" content="准备工作🍉 本系列的awk教程中，将大量使用到如下示例文件a.txt。 1234567891011ID  name    gender  age  email          phone1   Bob     male    28   abc@qq.com     180233940122   Alice   female  24   def@gmail.com  180849252033">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.niux.plus/LightPicture/2023/01/7bffc4340863cc4a.png">
<meta property="article:published_time" content="2022-05-31T10:09:00.000Z">
<meta property="article:modified_time" content="2023-03-26T01:04:07.419Z">
<meta property="article:author" content="YYDS Space">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="三剑客">
<meta property="article:tag" content="Linux三剑客">
<meta property="article:tag" content="awk">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.niux.plus/LightPicture/2023/01/7bffc4340863cc4a.png"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.yyds.space/posts/626e4dad2867"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux三剑客系列之awk',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-26 09:04:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><link rel="stylesheet" href="https://cdn1.tianli0.top/gh/zhheo/Post-Abstract-AI@0.9/tianli_gpt.css"><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="YYDS Space" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.whbblog.cn/other/touxiang.jpg" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">92</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">119</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-a-homeliving"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-anquan"></use></svg><span class="menu_word" style="font-size:17px"> 负载均衡</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/F5/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-slbfuzaijunhengSLB">                   </use></svg><span class="menu_word" style="font-size:17px"> F5</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/nginx/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nginx">                   </use></svg><span class="menu_word" style="font-size:17px"> NGINX</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/haproxy/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-daililiebiaoICO">                   </use></svg><span class="menu_word" style="font-size:17px"> HAProxy</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/lvs/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-slbfuzaijunheng1">                   </use></svg><span class="menu_word" style="font-size:17px"> LVS</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yun"></use></svg><span class="menu_word" style="font-size:17px"> Cloud</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/tcpip/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangluo">                   </use></svg><span class="menu_word" style="font-size:17px"> TCP/IP</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/docker/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-jingyu">                   </use></svg><span class="menu_word" style="font-size:17px"> Docker</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/openstack/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-icon_openstack">                   </use></svg><span class="menu_word" style="font-size:17px"> Openstack</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/k8s/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-chuanduo">                   </use></svg><span class="menu_word" style="font-size:17px"> Kubernetes</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/linux/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-linux">                   </use></svg><span class="menu_word" style="font-size:17px"> Linux</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-bug"></use></svg><span class="menu_word" style="font-size:17px"> 测试</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shuji">                   </use></svg><span class="menu_word" style="font-size:17px"> 测试基础</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/python/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-python">                   </use></svg><span class="menu_word" style="font-size:17px"> Python</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-ceshi">                   </use></svg><span class="menu_word" style="font-size:17px"> 自动化测试</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qita"></use></svg><span class="menu_word" style="font-size:17px"> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/hexo/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-hexo">                   </use></svg><span class="menu_word" style="font-size:17px"> Hexo</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/website/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujuzhanshi">                   </use></svg><span class="menu_word" style="font-size:17px"> 建站</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/%E6%9D%82%E9%A1%B9/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenleiorguangchangorqitatianchong">                   </use></svg><span class="menu_word" style="font-size:17px"> 杂项</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://news.yyds.space/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 早报</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 统计</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站事件</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于站长</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">YYDS Space</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-a-homeliving"></use></svg><span class="menu_word" style="font-size:17px"> 首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-anquan"></use></svg><span class="menu_word" style="font-size:17px"> 负载均衡</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/F5/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-slbfuzaijunhengSLB">                   </use></svg><span class="menu_word" style="font-size:17px"> F5</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/nginx/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nginx">                   </use></svg><span class="menu_word" style="font-size:17px"> NGINX</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/haproxy/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-daililiebiaoICO">                   </use></svg><span class="menu_word" style="font-size:17px"> HAProxy</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/lvs/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-slbfuzaijunheng1">                   </use></svg><span class="menu_word" style="font-size:17px"> LVS</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yun"></use></svg><span class="menu_word" style="font-size:17px"> Cloud</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/tcpip/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangluo">                   </use></svg><span class="menu_word" style="font-size:17px"> TCP/IP</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/docker/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-jingyu">                   </use></svg><span class="menu_word" style="font-size:17px"> Docker</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/openstack/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-icon_openstack">                   </use></svg><span class="menu_word" style="font-size:17px"> Openstack</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/k8s/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-chuanduo">                   </use></svg><span class="menu_word" style="font-size:17px"> Kubernetes</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/linux/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-linux">                   </use></svg><span class="menu_word" style="font-size:17px"> Linux</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-bug"></use></svg><span class="menu_word" style="font-size:17px"> 测试</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/%E6%B5%8B%E8%AF%95%E5%9F%BA%E7%A1%80/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shuji">                   </use></svg><span class="menu_word" style="font-size:17px"> 测试基础</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/python/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-python">                   </use></svg><span class="menu_word" style="font-size:17px"> Python</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-ceshi">                   </use></svg><span class="menu_word" style="font-size:17px"> 自动化测试</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qita"></use></svg><span class="menu_word" style="font-size:17px"> 其他</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/categories/hexo/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-hexo">                   </use></svg><span class="menu_word" style="font-size:17px"> Hexo</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/website/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujuzhanshi">                   </use></svg><span class="menu_word" style="font-size:17px"> 建站</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/%E6%9D%82%E9%A1%B9/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenleiorguangchangorqitatianchong">                   </use></svg><span class="menu_word" style="font-size:17px"> 杂项</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://news.yyds.space/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> 早报</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> 留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> 网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> 归档</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> 标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> 统计</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);" rel="external nofollow noreferrer"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> 个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> 网站事件</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> 网址导航</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> 关于站长</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()" rel="external nofollow noreferrer">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> 搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">Linux三剑客系列之awk</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于 </span><time class="post-meta-date-created" datetime="2022-05-31T10:09:00.000Z" title="发表于 2022-05-31 18:09:00">2022-05-31</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-26T01:04:07.419Z" title="更新于 2023-03-26 09:04:07">2023-03-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/linux/">linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1.6w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>64分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux三剑客系列之awk"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="准备工作🍉">准备工作🍉</h2>
<p>本系列的awk教程中，将大量使用到如下示例文件a.txt。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ID  name    gender  age  email          phone</span><br><span class="line">1   Bob     male    28   abc@qq.com     18023394012</span><br><span class="line">2   Alice   female  24   def@gmail.com  18084925203</span><br><span class="line">3   Tony    male    21   aaa@163.com    17048792503</span><br><span class="line">4   Kevin   male    21   bbb@189.com    17023929033</span><br><span class="line">5   Alex    male    18   ccc@xyz.com    18185904230</span><br><span class="line">6   Andy    female  22   ddd@139.com    18923902352</span><br><span class="line">7   Jerry   female  25   exdsa@189.com  18785234906</span><br><span class="line">8   Peter   male    20   bax@qq.com     17729348758</span><br><span class="line">9   Steven  female  23   bc@sohu.com    15947893212</span><br><span class="line">10  Bruce   female  27   bcbd@139.com   13942943905</span><br></pre></td></tr></table></figure>
<h2 id="一、awk用法入门🍅">一、awk用法入门🍅</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;awk_program&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>a.txt是awk要读取的文件，可以是0个文件或者1个文件，也可以是多个文件。当第一个文件执行完再按照循序依次执行。如果不给定任何文件，但又需要读取文件，则表示从标准输入中读取。</li>
<li>单引号包围的是awk代码，也称为awk程序。尽量使用单引号，因为在awk中经常使用<code>$</code>符号，而<code>$</code>符号在Shell中是变量符号，如果使用双引号包围awk代码，则<code>$</code>符号会被Shell解析为变量，然后进行Shell变量替换。使用单引号包围awk代码，则会使<code>$</code>脱离Shell的魔掌，使得<code>$</code>符号留给了awk去解析。</li>
<li>awk程序中，大量使用大括号，大括号表示代码块，代码块中间可以直接连用，代码块内部多个语句需使用分号<code>;</code>分隔。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">awk输出第一列，不指定读取的文件，则在标准输入中进行读取。</span></span><br><span class="line">awk &#x27;&#123;print $1&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出a.txt中的每一行</span></span><br><span class="line">awk &#x27;&#123;print $0&#125;&#x27; a.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">多个代码块，代码块中多个语句。输出每行之后还输出两行：hello行和world行</span></span><br><span class="line">awk &#x27;&#123;print $0&#125;&#123;print &quot;hello&quot;;print &quot;world&quot;&#125;&#x27; a.txt </span><br></pre></td></tr></table></figure>
<p>对于<code>awk '&#123;print $0&#125;' a.txt</code>，它类似于shell的while循环<code>while read line;do echo &quot;$line&quot;;done &lt;a.txt</code>。awk隐藏了读取每一行的while循环，它会自动读取每一行，其中的<code>&#123;print $0&#125;</code>对应于Shell的while循环体<code>echo &quot;$line&quot;</code>部分。</p>
<p>下面再分析该awk命令的执行过程：</p>
<ol>
<li>读取文件第一行(awk默认按行读取文件)</li>
<li>将所读取的行赋值给awk的变量<code>$0</code>，于是<code>$0</code>中保存的就是本次所读取的行数据</li>
<li>进入代码块<code>&#123;print $0&#125;</code>并执行其中代码<code>print $0</code>，即输出<code>$0</code>，也即输出当前所读取的行</li>
<li>执行完本次代码之后，进入下一轮awk循环：继续读取下一行(第二行)
<ul>
<li>将第二行赋值给变量<code>$0</code></li>
<li>进入代码块执行<code>print $0</code></li>
<li>执行完代码块后再次进入下一轮awk循环，即读取第三行，然后赋值给<code>$0</code>，再执行代码块</li>
<li>…不断循环，直到读完文件所有数据…</li>
</ul>
</li>
<li>退出awk</li>
</ol>
<h2 id="二、BEGIN-和-END-语句块🥕">二、BEGIN 和 END 语句块🥕</h2>
<p>awk的所有代码(目前这么认为)都是写在语句块中的。</p>
<p>每个语句块前面可以有pattern，所以格式为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pattern1&#123;statement1&#125;pattern2&#123;statement2;statement3;...&#125;</span><br></pre></td></tr></table></figure>
<p>语句块可分为3类：BEGIN语句块、END语句块和main语句块。其中BEGIN语句块和END语句块都是的格式分别为<code>BEGIN&#123;...&#125;</code>和<code>END&#123;...&#125;</code>，而main语句块是一种统称，它的pattern部分没有固定格式，也可以省略，main代码块是在读取文件的每一行的时候都执行的代码块。</p>
<p>分析下面三个awk命令的执行结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例一：</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print &quot;我在前面&quot;&#125;&#123;print $0&#125;&#x27;</span> a.txt </span><br><span class="line">我在前面</span><br><span class="line">ID  name    gender  age  email          phone</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例二</span></span><br><span class="line">awk <span class="string">&#x27;END&#123;print &quot;我在后面&quot;&#125;&#123;print $0&#125;&#x27;</span> a.txt </span><br><span class="line">ID  name    gender  age  email          phone</span><br><span class="line">......</span><br><span class="line">10  Bruce   female  27   bcbd@139.com   13942943905</span><br><span class="line">我在后面</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例三</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;print &quot;我在前面&quot;&#125;&#123;print $0&#125;END&#123;print &quot;我在后面&quot;&#125;&#x27;</span> a.txt</span><br><span class="line">我在前面</span><br><span class="line">ID  name    gender  age  email          phone</span><br><span class="line">......</span><br><span class="line">10  Bruce   female  27   bcbd@139.com   13942943905</span><br><span class="line">我在后面</span><br></pre></td></tr></table></figure>
<p>根据上面3行命令的执行结果，可总结出如下有关于BEGIN、END和main代码块的特性：</p>
<p><strong>BEGIN代码块：</strong></p>
<ul>
<li>在读取文件之前执行，且执行一次</li>
<li>在BEGIN代码块中，无法使用<code>$0</code>或其它一些特殊变量</li>
</ul>
<p><strong>main代码块：</strong></p>
<ul>
<li>读取文件时循环执行，(默认情况)每读取一行，就执行一次main代码块</li>
<li>main代码块可有多个</li>
</ul>
<p><strong>END代码块：</strong></p>
<ul>
<li>在读取文件完成之后执行，且执行一次</li>
<li>有END代码块，必有要读取的数据(可以是标准输入)</li>
<li>END代码块中可以使用<code>$0</code>等一些特殊变量，只不过这些特殊变量保存的是最后一轮awk循环的数据。</li>
</ul>
<h2 id="三、awk命令行结构和awk语法结构🌽">三、awk命令行结构和awk语法结构🌽</h2>
<h3 id="1、awk命令行结构">1、awk命令行结构</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk [ -- ] program-text file ...        (1)</span><br><span class="line">awk -f program-file [ -- ] file ...     (2)</span><br><span class="line">awk -e program-text [ -- ] file ...     (3)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>program-text</code> 即 awk 命令行中的 awk 代码部分，一般使用单引号包围。</li>
<li><code>-f program-file</code> 表示将 awk 代码部分写在文件中，然后使用 <code>-f</code> 选项去引用这个文件。</li>
<li><code>-e program-text</code> 也用于指定 awk 代码，所以语法(1)和语法(3)是等价的，但是既要使用 -f 又要在命令行写 awk 代码，则必须使用 <code>-f</code> 和 <code>-e</code> ，即 <code>awk -f file -e 'awk_code'</code>，而不能是 <code>awk -f file 'awk_code'</code>。</li>
</ul>
<h3 id="2、awk语法结构">2、awk语法结构</h3>
<p>awk语法结构即awk代码部分的结构。</p>
<p>awk的语法充斥着<code>pattern&#123;action&#125;</code>的模式，它们称为awk rule。</p>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  BEGIN&#123;n=3&#125; </span></span><br><span class="line"><span class="string">  /^[0-9]/$1&gt;5&#123;$1=333;print $1&#125;</span></span><br><span class="line"><span class="string">  /Alice/&#123;print &quot;Alice&quot;&#125;</span></span><br><span class="line"><span class="string">  END&#123;print &quot;hello&quot;&#125;</span></span><br><span class="line"><span class="string">&#x27;</span> a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价的单行式:</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;n=3&#125; /^[0-9]/&#123;$1&gt;5&#123;$1=333;print $1&#125; /Alice/&#123;print &quot;Alice&quot;&#125; END&#123;print &quot;hello&quot;&#125;&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<p>上面示例中，有BEGIN语句块，有END语句块，还有2个main代码块，两个main代码块都使用了正则表达式作为pattern。</p>
<p>关于awk的语法：</p>
<ul>
<li>多个<code>pattern&#123;action&#125;</code>可以直接连接连用</li>
<li>action中多个语句如果写在同一行，则需使用分号分隔</li>
<li>pattern部分用于筛选行，action表示在筛选通过后执行的操作</li>
<li>pattern和action都可以省略
<ul>
<li>省略 pattern ，等价于对每一行数据都执行 action
<ul>
<li>例如：<code>awk '&#123;print $0&#125;' a.txt</code></li>
</ul>
</li>
<li>省略代码块 {action} ，等价于 {print} ，即输出所有行
<ul>
<li>例如：<code>awk '/Alice/' a.txt</code> 等价于 <code>awk '/Alice/&#123;print $0&#125;' a.txt</code></li>
</ul>
</li>
<li>省略代码块中的 action ，表示对筛选的行什么都不做
<ul>
<li>例如：<code>awk '/Alice/&#123;&#125;' a.txt</code></li>
</ul>
</li>
<li>pattern{action} 任何一部分都可以省略
<ul>
<li>例如:<code>awk '' a.txt</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3、pattern-和-action">3、pattern 和 action</h3>
<p>对于<code>pattern&#123;action&#125;</code>语句结构(都称之为语句块)，其中的pattern部分可以使用下面列出的模式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 特殊pattern</span></span><br><span class="line">BEGIN</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔代码块</span></span><br><span class="line">/regular expression/    <span class="comment"># 正则匹配成功与否 /a.*ef/&#123;action&#125;</span></span><br><span class="line">relational expression   <span class="comment"># 即等值比较、大小比较 3&gt;2&#123;action&#125;</span></span><br><span class="line">pattern &amp;&amp; pattern      <span class="comment"># 逻辑与 3&gt;2 &amp;&amp; 3&gt;1 &#123;action&#125;</span></span><br><span class="line">pattern || pattern      <span class="comment"># 逻辑或 3&gt;2 || 3&lt;1 &#123;action&#125;</span></span><br><span class="line">! pattern               <span class="comment"># 逻辑取反 !/a.*ef/&#123;action&#125;</span></span><br><span class="line">(pattern)               <span class="comment"># 改变优先级</span></span><br><span class="line">pattern ? pattern : pattern  <span class="comment"># 三目运算符决定的布尔值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 范围pattern，非布尔代码块</span></span><br><span class="line">pattern1, pattern2      <span class="comment"># 范围，pat1打开、pat2关闭，即flip,flop模式</span></span><br></pre></td></tr></table></figure>
<p>action部分，可以是任何语句，例如print。</p>
<h2 id="四、awk-选项、预定义变量🥦">四、awk 选项、预定义变量🥦</h2>
<h3 id="1、选项">1、选项</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-e program-text</span><br><span class="line">--source program-text</span><br><span class="line">指定awk程序表达式，可结合-f选项同时使用</span><br><span class="line">在使用了-f选项后，如果不使用-e，awk program是不会执行的，它会被当作ARGV的一个参数</span><br><span class="line"></span><br><span class="line">-f program-file</span><br><span class="line">--file program-file</span><br><span class="line">从文件中读取awk源代码来执行，可指定多个-f选项</span><br><span class="line"></span><br><span class="line">-F fs</span><br><span class="line">--field-separator fs</span><br><span class="line">指定输入字段分隔符(FS预定义变量也可设置)</span><br><span class="line"></span><br><span class="line">-n</span><br><span class="line">--non-decimal-data</span><br><span class="line">识别文件输入中的8进制数(0开头)和16进制数(0x开头)</span><br><span class="line">echo &#x27;030&#x27; | awk -n &#x27;&#123;print $1+0&#125;&#x27;</span><br><span class="line"></span><br><span class="line">-o [filename]</span><br><span class="line">格式化awk代码。</span><br><span class="line">不指定filename时，则默认保存到awkprof.out</span><br><span class="line">指定为`-`时，表示输出到标准输出</span><br><span class="line"></span><br><span class="line">-v var=val</span><br><span class="line">--assign var=val</span><br><span class="line">在BEGIN之前，声明并赋值变量var，变量可在BEGIN中使用</span><br></pre></td></tr></table></figure>
<h3 id="2、预定义变量">2、预定义变量</h3>
<p>预定义变量分为两类：控制awk工作的变量和携带信息的变量。</p>
<p><strong>第一类：控制AWK工作的预定义变量</strong></p>
<ul>
<li><code>RS</code>：输入记录分隔符，默认为换行符<code>\n</code></li>
<li><code>IGNORECASE</code>：默认值为0，表示所有的正则匹配不忽略大小写。设置为非0值（例如1），之后的匹配将忽略大小写。例如在BEGIN块中将其设置为1，将使FS、RS都以忽略大小写的方式分隔字段或分隔record</li>
<li><code>FS</code>：读取记录后，划分为字段的字段分隔符。</li>
<li><code>FIELDWIDTHS</code>：以指定宽度切割字段而非按照FS。</li>
<li><code>FPAT</code>：以正则匹配匹配到的结果作为字段，而非按照FS划分。</li>
<li><code>OFS</code>：print命令输出各字段列表时的输出字段分隔符，默认为空格。</li>
<li><code>ORS</code>：print命令输出数据时在尾部自动添加的记录分隔符，默认为换行符<code>\n。</code></li>
<li><code>CONVFMT</code>：在awk中数值隐式转换为字符串时，将根据CONVFMT的格式按照s<code>printf()</code>的方式自动转换为字符串。默认值为<code>%.6g。</code></li>
<li><code>OFMT</code>：在print中，数值会根据OFMT的格式按照sprintf()的方式自动转换为字符串。默认值为<code>%.6g</code>。</li>
</ul>
<p><strong>第二类：携带信息的预定义变量</strong></p>
<ul>
<li><code>FILENAME</code>：awk当前正在处理的文件(命令行中指定的文件)，所以在BEGIN中该变量值为空。</li>
<li><code>ENVIRON</code>：保存了Shell的环境变量的数组。例如<code>ENVIRON[&quot;HOME&quot;]</code>将返回当前用户的家目录。</li>
<li><code>NR</code>:当前已读总记录数，多个文件从不会重置为0，所以它是一直叠加的。
<ul>
<li>可以直接修改NR，下次读取记录时将在此修改值上自增。</li>
</ul>
</li>
<li><code>FNR</code>:当前正在读取文件的第几条记录，每次打开新文件会重置为0。
<ul>
<li>可以直接修改FNR，下次读取记录时将在此修改值上自增。</li>
</ul>
</li>
<li><code>NF</code>：当前记录的字段数。</li>
<li><code>RT</code>：在读取记录时真正的记录分隔符。</li>
</ul>
<h2 id="五、awk-读取行🍄">五、awk 读取行🍄</h2>
<h3 id="1、详细分析-awk-如何读取文件">1、详细分析 awk 如何读取文件</h3>
<p>awk读取输入文件时，每次读取一条记录(record)(默认情况下按行读取，所以此时记录就是行)。每读取一条记录，将其保存到<code>$0</code>中，然后执行一次main代码段。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print $0&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>如果是空文件，则因为无法读取到任何一条记录，将导致直接关闭文件，而不会进入main代码段。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> x.log  <span class="comment"># 创建一个空文件</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print &quot;hello world&quot;&#125;&#x27;</span> x.log</span><br></pre></td></tr></table></figure>
<p>可设置表示输入记录分隔符的预定义变量RS(Record Separator)来改变每次读取的记录模式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RS=&quot;\n&quot; 、 RS=&quot;m&quot;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;RS=&quot;\n&quot;&#125;&#123;print $0&#125;&#x27;</span> a.txt</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;RS=&quot;m&quot;&#125;&#123;print $0&#125;&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<p>RS通常设置在BEGIN代码块中，因为要先于读取文件就确定好RS分隔符。</p>
<blockquote>
<p>RS指定输入记录分隔符时，所读取的记录中是不包含分隔符字符的。例如<code>RS=&quot;a&quot;</code>，则<code>$0</code>中一定不可能出现字符a。</p>
</blockquote>
<p>RS有两种可能情况：</p>
<ul>
<li>RS为单个字符：直接使用该字符分割记录</li>
<li>RS为多个字符：将其当作正则表达式，只要匹配正则表达式的符号，都用来分割记录</li>
</ul>
<p>特殊的RS值用来解决特殊读取需求：</p>
<ul>
<li><code>RS=&quot;&quot;</code>：按段落读取</li>
<li><code>RS=&quot;\0&quot;</code>：一次性读取所有数据，但有些特殊文件中包含了空字符<code>\0</code></li>
<li><code>RS=&quot;^$&quot;</code>：真正的一次性读取所有数据，因为非空文件不可能匹配成功</li>
<li><code>RS=&quot;\n+&quot;</code>：按行读取，但忽略所有空行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按段落读取：RS=&#x27;&#x27;</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;RS=&#x27;</span><span class="string">&#x27;&#125;&#123;print $0&quot;&quot;&#125;&#x27;</span> a.txt     </span><br><span class="line"></span><br><span class="line"><span class="comment"># 一次性读取所有数据：RS=&#x27;\0&#x27; RS=&quot;^$&quot;</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;RS=&#x27;</span>\0<span class="string">&#x27;&#125;&#123;print $0&quot;&quot;&#125;&#x27;</span> a.txt     </span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;RS=&#x27;</span>^$<span class="string">&#x27;&#125;&#123;print $0&quot;&quot;&#125;&#x27;</span> a.txt  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略空行：RS=&#x27;\n+&#x27;</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;RS=&#x27;</span>\n+<span class="string">&#x27;&#125;&#123;print $0&quot;&quot;&#125;&#x27;</span> a.txt </span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略大小写：预定义变量IGNORECASE设置为非0值</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;IGNORECASE=1&#125;&#123;print $0&quot;&quot;&#125;&#x27;</span> RS=<span class="string">&#x27;[ab]&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>预定义变量RT：</p>
<p>在awk每次读完一条记录时，会设置一个称为RT的预定义变量，表示Record Termination。</p>
<p>当RS为单个字符时，RT的值和RS的值是相同的。</p>
<p>当RS为多个字符(正则表达式)时，则RT设置为正则匹配到记录分隔符之后，真正用于划分记录时的字符。</p>
<p>当无法匹配到记录分隔符时，RT设置为控制空字符串(即默认的初始值)。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例一</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;RS=&quot;(fe)?male&quot;&#125;&#123;print RT&#125;&#x27;</span> a.txt</span><br><span class="line">male</span><br><span class="line">female</span><br><span class="line">......</span><br><span class="line"><span class="comment"># 示例二</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;RS=&quot;m&quot;&#125;&#123;print RT&#125;&#x27;</span> a.txt</span><br><span class="line">m</span><br><span class="line">m</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h3 id="2、两种行号：NR和FNR">2、两种行号：NR和FNR</h3>
<p>在读取每条记录之后，将其赋值给$0，同时还会设置NR、FNR、RT。</p>
<ul>
<li>NR：所有文件的行号计数器</li>
<li>FNR：是各个文件的行号计数器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print NR&#125;&#x27; a.txt a.txt</span><br><span class="line">awk &#x27;&#123;print FNR&#125;&#x27; a.txt a.txt</span><br></pre></td></tr></table></figure>
<h3 id="3、-0重构-1-1">3、$0重构 -&gt; <code>$1=$1</code></h3>
<p>注意下面的分割和计算两词：分割表示使用FS（field Separator），计算表示使用预定义变量OFS（Output Field Separator）。</p>
<ol>
<li>修改<code>$0</code>，将使用<code>FS</code>重新分割字段，所以会影响<code>$1、$2...</code></li>
<li>修改<code>$1、$2</code>，将根据<code>$1</code>到<code>$NF</code>等各字段来重新计算<code>$0</code>，即使是<code>$1 = $1</code>这样的原值不变的修改，也一样会重新计算<code>$0</code></li>
<li>为不存在的字段赋值，将新增字段并按需使用空字符串填充中间的字段，并使用<code>OFS</code>重新计算<code>$0</code>。<br>
<code>awk 'BEGIN&#123;OFS=&quot;-&quot;&#125;&#123;$(NF+2)=5;print $0&#125;' a.txt</code></li>
<li>增加NF值，将使用空字符串新增字段，并使用<code>OFS</code>重新计算<code>$0</code><br>
<code>awk 'BEGIN&#123;OFS=&quot;-&quot;&#125;&#123;NF+=3;print $0&#125;' a.txt</code></li>
<li>减小NF值，将丢弃一定数量的尾部字段，并使用<code>OFS</code>重新计算<code>$0</code><br>
<code>awk 'BEGIN&#123;OFS=&quot;-&quot;&#125;&#123;NF-=3;print $0&#125;' a.txt</code></li>
</ol>
<p>当读取一条record之后，将原原本本地被保存到<code>$0</code>当中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print $0&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>但是，只要出现了上面所说的任何一种导致<code>$0</code>重新计算的操作，都会使用<code>OFS</code>去重建<code>$0</code>。</p>
<p>换句话说，没有导致<code>$0</code>重建，<code>$0</code>就一直是原原本本的数据，所以指定OFS也无效。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;OFS=&quot;-&quot;&#125;&#123;print $0&#125;&#x27; a.txt  # OFS此处无效</span><br></pre></td></tr></table></figure>
<p>当<code>$0</code>重建后，将自动使用OFS重建，所以即使没有指定OFS，它也会采用默认值(空格)进行重建。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;$1=$1;print $0&#125;&#x27;  a.txt  # 输出时将以空格分隔各字段</span><br><span class="line">awk &#x27;&#123;print $0;$1=$1;print $0&#125;&#x27; OFS=&quot;-&quot; a.txt</span><br></pre></td></tr></table></figure>
<p>如果重建<code>$0</code>之后，再去修改OFS，将对当前行无效，但对之后的行有效。所以如果也要对当前行生效，需要再次重建。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OFS对第一行无效</span></span><br><span class="line">awk &#x27;&#123;$4+=10;OFS=&quot;-&quot;;print $0&#125;&#x27; a.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">对所有行有效</span></span><br><span class="line">awk &#x27;&#123;$4+=10;OFS=&quot;-&quot;;$1=$1;print $0&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>当我们为字段变量赋值时，即。值为 <code>$1</code> 分配给字段 <code>$1</code>，awk 实际上通过用默认字段分隔符（或 OFS） 空间连接它们来重建其 <code>$0</code>。</p>
<p>技巧1：<code>$0</code>重建。例如，下面通过重建<code>$0</code>的技巧来实现去除行首行尾空格并压缩中间空格：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;   a  b  c   d   &quot;</span> | awk <span class="string">&#x27;&#123;$1=$1;print&#125;&#x27;</span></span></span><br><span class="line">a b c d</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;     a   b  c   d   &quot;</span> | awk <span class="string">&#x27;&#123;$1=$1;print&#125;&#x27;</span> OFS=<span class="string">&quot;-&quot;</span></span>            </span><br><span class="line">a-b-c-d</span><br></pre></td></tr></table></figure>
<p>技巧2：添加<code>1</code>快捷方式。1是打印当前记录的常见AWK技巧，相当于<code>&#123;print $0&#125;</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">以下三条命令等价，输出相同结果</span></span><br><span class="line">awk &#x27;BEGIN&#123;print &quot;abc&quot;&#125;1&#x27; a.txt</span><br><span class="line">awk &#x27;BEGIN&#123;print &quot;abc&quot;&#125;&#123;print&#125;&#x27; a.txt </span><br><span class="line">awk &#x27;BEGIN&#123;print &quot;abc&quot;&#125;&#123;print $0&#125;&#x27; a.txt </span><br></pre></td></tr></table></figure>
<h2 id="六、详细分析awk字段分割🐼">六、详细分析awk字段分割🐼</h2>
<p>awk读取每一条记录之后，会将其赋值给<code>$0</code>，同时还会对这条记录按照<strong>预定义变量FS</strong>划分字段，将划分好的各个字段分别赋值给<code>$1 $2 $3 $4...$N</code>，同时将划分的字段数量赋值给<strong>预定义变量NF</strong>。</p>
<h3 id="1、引用字段的方式">1、引用字段的方式</h3>
<p><code>$N</code>引用字段：</p>
<ul>
<li><code>N=0</code>：即<code>$0</code>，引用记录本身</li>
<li><code>0&lt;N&lt;=NF</code>：引用对应字段</li>
<li><code>N&gt;NF</code>：表示引用不存在的字段，返回空字符串</li>
<li><code>N&lt;0</code>：报错</li>
</ul>
<p>可使用变量或计算的方式指定要获取的字段序号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;n = 5;print $n&#125;&#x27; a.txt</span><br><span class="line">awk &#x27;&#123;print $(2+2)&#125;&#x27; a.txt   # 括号必不可少，用于改变优先级</span><br><span class="line">awk &#x27;&#123;print $(NF-3)&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<h3 id="2、分割字段的方式">2、分割字段的方式</h3>
<p>读取record之后，将使用预定义变量FS、FIELDWIDTHS或FPAT中的一种来分割字段。分割完成之后，再进入main代码段(所以，在main中设置FS对本次已经读取的record是没有影响的，但会影响下次读取)。</p>
<h4 id="（1）划分字段方式-一-：FS或-F">（1）划分字段方式(一)：FS或-F</h4>
<p><code>FS</code>或者<code>-F</code>：字段分隔符</p>
<ul>
<li>FS为单个字符时，该字符即为字段分隔符</li>
<li>FS为多个字符时，则采用正则表达式模式作为字段分隔符</li>
<li>特殊的，也是FS默认的情况，<strong>FS为单个空格时，将以连续的空白（空格、制表符、换行符）作为字段分隔符</strong></li>
<li>特殊的，FS为空字符串””时，将对每个字符都进行分隔，即每个字符都作为一个字段</li>
<li>设置预定义变量IGNORECASE为非零值，正则匹配时表示忽略大小写(只影响正则，所以FS为单字时无影响)</li>
<li>如果record中无法找到FS指定的分隔符(例如将FS设置为”\n”)，则整个记录作为一个字段，即<code>$1</code>和<code>$0</code>相等</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字段分隔符指定为单个字符</span></span><br><span class="line">awk -F<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;&#125;&#123;print $1&#125;&#x27;</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字段分隔符指定为正则表达式</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot; +|@&quot;&#125;&#123;print $1,$2,$3,$4,$5,$6&#125;&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<h4 id="（2）划分字段方式-二-：FIELDWIDTHS（了解，gawk支持）">（2）划分字段方式(二)：FIELDWIDTHS（了解，gawk支持）</h4>
<p>指定预定义变量FIELDWIDTHS按字符宽度分割字段，这是gawk提供的高级功能。在处理某字段缺失时非常好用。</p>
<p>用法：</p>
<ul>
<li>FIELDWIDTHS=“3 5 6 9” 表示第一个字段3字符，第二个字段5字符…</li>
<li>FIELDWIDTHS=“8 1:5 6 2:33” 表示第一个字段读8个字符，跳过一个字符再读5个字符作为第二个字段，然后读6个字符作为第三个字段。最后跳过2个字符再读33个字符作为第四个字段（如果不足33个字符，则读到结尾）</li>
<li>FIELDWIDTHS=“2 3 *” 表示第一个字段2个字符，第二个字段3个字符，第三个字符剩余所有字符，星号只能放在最后，且只能单独使用，表示剩余所有。</li>
</ul>
<p>示例1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没取完的字符串DDD被丢弃，且NF=3</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;FIELDWIDTHS=&quot;2 3 2&quot;&#125;&#123;print $1,$2,$3,$4&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;AABBBCCDDDD&quot;</span></span><br><span class="line">AA BBB CC </span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串不够长度时无视</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;FIELDWIDTHS=&quot;2 3 2 100&quot;&#125;&#123;print $1,$2,$3,$4&quot;-&quot;&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;AABBBCCDDDD&quot;</span></span><br><span class="line">AA BBB CC DDDD-</span><br><span class="line"></span><br><span class="line"><span class="comment"># *号取剩余所有，NF=3</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;FIELDWIDTHS=&quot;2 3 *&quot;&#125;&#123;print $1,$2,$3&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;AABBBCCDDDD&quot;</span>      </span><br><span class="line">AA BBB CCDDDD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字段数多了，则取完字符串即可，NF=2</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;FIELDWIDTHS=&quot;2 30 *&quot;&#125;&#123;print $1,$2,NF&#125;&#x27;</span> &lt;&lt;&lt;<span class="string">&quot;AABBBCCDDDD&quot;</span>  </span><br><span class="line">AA BBBCCDDDD 2</span><br></pre></td></tr></table></figure>
<p>示例2：处理某些字段缺失的数据。</p>
<p>如果按照常规的FS进行字段分割，则对于缺失字段的行和没有缺失字段的行很难统一处理，但使用FIELDWIDTHS则非常方便。</p>
<p>因为email字段有的是空字段，所以直接用FS划分字段不便处理。可使用FIELDWIDTHS。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字段1：4字符</span></span><br><span class="line"><span class="comment"># 字段2：8字符</span></span><br><span class="line"><span class="comment"># 字段3：8字符</span></span><br><span class="line"><span class="comment"># 字段4：2字符</span></span><br><span class="line"><span class="comment"># 字段5：先跳过3字符，再读13字符，该字段13字符</span></span><br><span class="line"><span class="comment"># 字段6：先跳过2字符，再读11字符，该字段11字符</span></span><br><span class="line">awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">BEGIN&#123;FIELDWIDTHS=&quot;4 8 8 2 3:13 2:11&quot;&#125;</span></span><br><span class="line"><span class="string">NR&gt;1&#123;</span></span><br><span class="line"><span class="string">    print &quot;&lt;&quot;$1&quot;&gt;&quot;,&quot;&lt;&quot;$2&quot;&gt;&quot;,&quot;&lt;&quot;$3&quot;&gt;&quot;,&quot;&lt;&quot;$4&quot;&gt;&quot;,&quot;&lt;&quot;$5&quot;&gt;&quot;,&quot;&lt;&quot;$6&quot;&gt;&quot;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> a.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果email为空，则输出它</span></span><br><span class="line">awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">BEGIN&#123;FIELDWIDTHS=&quot;4 8 8 2 3:13 2:11&quot;&#125;</span></span><br><span class="line"><span class="string">NR&gt;1&#123;</span></span><br><span class="line"><span class="string">    if($5 ~ /^ +$/)&#123;print $0&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<h4 id="（3）划分字段方式-三-：FPAT（了解，gawk支持）">（3）划分字段方式(三)：FPAT（了解，gawk支持）</h4>
<p>FS是指定字段分隔符，来取得除分隔符外的部分作为字段。</p>
<p>FPAT是取得匹配的字符部分作为字段。它是gawk提供的一个高级功能。</p>
<p>FPAT根据指定的正则来全局匹配record，然后将所有匹配成功的部分组成<code>$1、$2...</code>，不会修改<code>$0</code>。</p>
<ul>
<li><code>awk 'BEGIN&#123;FPAT=&quot;[0-9]+&quot;&#125;&#123;print $3&quot;-&quot;&#125;' a.txt</code></li>
<li>之后再设置FS或FPAT，该变量将失效</li>
</ul>
<p>FPAT常用于字段中包含了字段分隔符的场景。例如，CSV文件中的一行数据如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Robbins,Arnold,<span class="string">&quot;1234 A Pretty Street, NE&quot;</span>,MyTown,MyState,12345-6789,USA</span><br></pre></td></tr></table></figure>
<p>其中逗号分隔每个字段，但双引号包围的是一个字段整体，即使其中有逗号。</p>
<p>这时使用FPAT来划分各字段比使用FS要方便的多。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Robbins,Arnold,&quot;1234 A Pretty Street, NE&quot;,MyTown,MyState,12345-6789,USA&#x27;</span> |\</span><br><span class="line">awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">    BEGIN&#123;FPAT=&quot;[^,]*|(\&quot;[^\&quot;]*\&quot;)&quot;&#125;</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        for (i=1;i&lt;NF;i++)&#123;</span></span><br><span class="line"><span class="string">            print &quot;&lt;&quot;$i&quot;&gt;&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>
<p>最后，patsplit()函数和FPAT的功能一样。</p>
<h2 id="七、awk筛选行和处理字段🦉">七、awk筛选行和处理字段🦉</h2>
<h3 id="1、筛选行">1、筛选行</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.根据行号筛选</span></span><br><span class="line">awk <span class="string">&#x27;NR==2&#x27;</span> a.txt   <span class="comment"># 筛选出第二行</span></span><br><span class="line">awk <span class="string">&#x27;NR&gt;=2&#x27;</span> a.txt   <span class="comment"># 输出第2行和之后的行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.根据正则表达式筛选整行</span></span><br><span class="line">awk <span class="string">&#x27;/qq.com/&#x27;</span> a.txt       <span class="comment"># 输出带有qq.com的行</span></span><br><span class="line">awk <span class="string">&#x27;$0 ~ /qq.com/&#x27;</span> a.txt  <span class="comment"># 等价于上面命令</span></span><br><span class="line">awk <span class="string">&#x27;/^[^@]+$/&#x27;</span> a.txt      <span class="comment"># 输出不包含@符号的行</span></span><br><span class="line">awk <span class="string">&#x27;!/@/&#x27;</span> a.txt           <span class="comment"># 输出不包含@符号的行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.根据字段来筛选行</span></span><br><span class="line">awk <span class="string">&#x27;($4+0) &gt; 24&#123;print $0&#125;&#x27;</span> a.txt  <span class="comment"># 输出第4字段大于24的行</span></span><br><span class="line">awk <span class="string">&#x27;$5 ~ /qq.com/&#x27;</span> a.txt   <span class="comment"># 输出第5字段包含qq.com的行</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.将多个筛选条件结合起来进行筛选</span></span><br><span class="line">awk <span class="string">&#x27;NR&gt;=2 &amp;&amp; NR&lt;=7&#x27;</span> a.txt </span><br><span class="line">awk <span class="string">&#x27;$3==&quot;male&quot; &amp;&amp; $6 ~ /^170/&#x27;</span> a.txt       </span><br><span class="line">awk <span class="string">&#x27;$3==&quot;male&quot; || $6 ~ /^170/&#x27;</span> a.txt  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.按照范围进行筛选 flip flop</span></span><br><span class="line"><span class="comment"># pattern1,pattern2&#123;action&#125;</span></span><br><span class="line">awk <span class="string">&#x27;NR==2,NR==7&#x27;</span> a.txt        <span class="comment"># 输出第2到第7行</span></span><br><span class="line">awk <span class="string">&#x27;NR==2,$6 ~ /^170/&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<h3 id="2、处理字段">2、处理字段</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;NR&gt;1&#123;$4=$4+5;print $0&#125;&#x27;</span> a.txt</span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;OFS=&quot;-&quot;&#125;NR&gt;1&#123;$4=$4+5;print $0&#125;&#x27;</span> a.txt</span><br><span class="line">awk <span class="string">&#x27;NR&gt;1&#123;$6=$6&quot;*&quot;;print $0&#125;&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<h2 id="小测试：awk运维面试试题">小测试：awk运维面试试题</h2>
<p>从ifconfig命令的结果中筛选出除了lo网卡外的所有IPv4地址。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.法一：多条件筛选</span></span><br><span class="line">ifconfig | awk <span class="string">&#x27;/inet / &amp;&amp; !($2 ~ /^127/)&#123;print $2&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.法二：按段落读取，然后取IPv4字段</span></span><br><span class="line">ifconfig | awk <span class="string">&#x27;BEGIN&#123;RS=&quot;&quot;&#125;!/lo/&#123;print $6&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.法三：按段落读取，每行1字段，然后取IPv4字段</span></span><br><span class="line">ifconfig | awk <span class="string">&#x27;BEGIN&#123;RS=&quot;&quot;;FS=&quot;\n&quot;&#125;!/lo/&#123;$0=$2;FS=&quot; &quot;;$0=$0;print $2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="八、awk-工作流程🐧">八、awk 工作流程🐧</h2>
<blockquote>
<ol>
<li>解析 <code>-v var=val ...</code> 选项中的变量赋值</li>
<li>编译awk源代码为可解释的内部格式，包括 <code>-v</code> 的变量</li>
<li>执行BEGIN代码段</li>
<li>根据输入记录分隔符RS读取文件（根据ARGV数组的元素决定要读取的文件），如果没有指定文件，则从标准输入中读取文件，同时执行main代码段
<ul>
<li>如果文件名部分指定var=val格式，则声明并创建变量，此阶段再BEGIN声明之后，所以BEGIN中不可用，main代码段可用</li>
<li>每读取一条记录，都将设置NR、FNR、RT、$0等变量。（默认）根据输入字段分隔符FS切割字段，将各字段保存到<code>$1、$2...</code>中。测试main代码段的pattern部分，如果测试成功，则执行action部分。</li>
</ul>
</li>
<li>执行END代码段。</li>
</ol>
</blockquote>
<p><strong>流程图</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.whbblog.cn/img/AWK.png" alt="AWK" style="zoom: 50%;" />
<h2 id="九、getline-用法详解🐲">九、getline 用法详解🐲</h2>
<p>除了可以从标准输入或非选项型参数所指定的文件中读取数据，还可以使用getline从其它各种渠道获取需要处理的数据，它的用法有很多种。</p>
<p>getline的返回值：</p>
<ul>
<li>如果可以读取到数据，返回1</li>
<li>如果遇到了EOF，返回0</li>
<li>如果遇到了错误，返回负数。如-1表示文件无法打开，-2表示IO操作需要重试(retry)。在遇到错误的同时，还会设置<code>ERRNO</code>变量来描述错误</li>
</ul>
<p>为了健壮性，getline时强烈建议进行判断。例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ((getline) &lt;= 0 )&#123;...&#125;</span><br><span class="line">if ((getline) &lt; 0 )&#123;...&#125;</span><br><span class="line">if ((getline) &gt; 0 )&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>上面的<code>getline</code>的括号尽量加上，因为<code>getline &lt; 0</code>表示的是输入重定向，而不是和数值0进行小于号的比较。</p>
<h3 id="1、无参数的-getline">1、无参数的 getline</h3>
<p>getline无参数时，表示从当前正在处理的文件中立即读取下一条记录保存到<code>$0</code>中，并进行字段分割，然后<strong>继续执行后续代码逻辑</strong>。</p>
<p>此时的getline会设置NF、RT、NR、FNR、$0和$N。</p>
<p>例如，匹配到某行之后，再读一行就退出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;/^1/&#123;print;getline;print;exit&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>为了更健壮，应当对getline的返回值进行判断。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;/^1/&#123;print;if((getline)&lt;=0)&#123;exit&#125;;print&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<h3 id="2、一个参数的getline">2、一个参数的getline</h3>
<p>没有参数的getline是读取下一条记录之后将记录保存到<code>$0</code>中，并对该记录进行字段的分割。</p>
<p>一个参数的getline是将读取的记录保存到指定的变量当中，并且不会对其进行分割。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getline <span class="keyword">var</span></span><br></pre></td></tr></table></figure>
<p>此时的getline只会设置RT、NR、FNR变量和指定的变量var。因此$0和$N以及NF保持不变。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">/^1/&#123;</span><br><span class="line">  if((getline var)&lt;=0)&#123;exit&#125;</span><br><span class="line">  print var</span><br><span class="line">  print $0&quot;--&quot;$2</span><br><span class="line">&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<h3 id="3、从指定文件中读取数据">3、从指定文件中读取数据</h3>
<ul>
<li><code>getline &lt; filename</code> : 从指定文件filename中读取一条记录保存到$0中，会进行字段的划分，会设置变量<code>$0 $N $NF</code>，不会设置变量<code>NR FNR</code></li>
<li><code>getline var &lt; filename</code> : 从指定文件filename 读取一条记录并保存到指定变量var中，不会划分字段，不会设置变量 <code>NR FNR NF $0 $N </code></li>
</ul>
<p>filename需使用双引号包围表示文件名字符串，否则会当作变量解析<code>getline &lt; &quot;c.txt&quot;</code>。此外，如果路径是使用变量构建的，则应该使用括号包围路径部分。例如<code>getline &lt; dir &quot;/&quot; filename</code>中使用了两个变量构建路径，这会产生歧义，应当写成<code>getline &lt;(dir &quot;/&quot; filename)</code>。</p>
<p>注意，每次从filename读取之后都会做好位置偏移标记，下次再从该文件读取时将根据这个位置标记继续向后读取。</p>
<p>例如，每次行首以1开头时就读取c.txt文件的所有行。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">/^1/&#123;</span></span><br><span class="line"><span class="string">  if((getline var)&lt;=0)&#123;exit&#125;</span></span><br><span class="line"><span class="string">  print var</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<p>上面的<code>close(&quot;c.txt&quot;)</code>表示在<code>while(getline)</code>读取完文件之后关掉，以便后面再次读取，如果不关掉，则文件偏移指针将一直在文件结尾处，使得下次读取时直接遇到EOF。</p>
<h3 id="4、从Shell命令输出结果中读取数据">4、从Shell命令输出结果中读取数据</h3>
<ul>
<li><code>cmd | getline</code>：从Shell命令cmd的输出结果中读取一条记录保存到<code>$0</code>中
<ul>
<li>会进行字段划分，设置变量<code>$0 NF $N RT</code>，不会修改变量<code>NR FNR</code></li>
</ul>
</li>
<li><code>cmd | getline var</code>:从Shell命令cmd的输出结果中读取数据保存到var中
<ul>
<li>除了var和RT，其它变量都不会设置</li>
</ul>
</li>
</ul>
<p>如果要再次执行cmd并读取其输出数据，则需要close关闭该命令。例如<code>close(&quot;seq 1 5&quot;)</code>，参见下面的示例。</p>
<p>例如：每次遇到以1开头的行都输出seq命令产生的<code>1 2 3 4 5</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;/^1/&#123;print;while((&quot;seq 1 5&quot;|getline)&gt;0)&#123;print&#125;;close(&quot;seq 1 5&quot;)&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>再例如，调用Shell的date命令生成时间，然后保存到awk变量cur_date中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  /^1/&#123;</span><br><span class="line">    print</span><br><span class="line">    &quot;date +\&quot;%F %T\&quot;&quot;|getline cur_date</span><br><span class="line">    print cur_date</span><br><span class="line">    close(&quot;date +\&quot;%F %T\&quot;&quot;)</span><br><span class="line">&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>可以将cmd保存成一个字符串变量。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  BEGIN&#123;get_date=&quot;date +\&quot;%F %T\&quot;&quot;&#125;</span><br><span class="line">  /^1/&#123;</span><br><span class="line">    print</span><br><span class="line">    get_date | getline cur_date</span><br><span class="line">    print cur_date</span><br><span class="line">    close(get_date)</span><br><span class="line">&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>更为复杂一点的，cmd中可以包含Shell的其它特殊字符，例如管道、重定向符号等：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  /^1/&#123;</span><br><span class="line">    print</span><br><span class="line">    if((&quot;seq 1 5 | xargs -i echo x&#123;&#125;y 2&gt;/dev/null&quot;|getline) &gt; 0)&#123;</span><br><span class="line">      print</span><br><span class="line">    &#125;</span><br><span class="line">    close(&quot;seq 1 5 | xargs -i echo x&#123;&#125;y 2&gt;/dev/null&quot;)</span><br><span class="line">&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<h3 id="5、awk中的coprocess">5、awk中的coprocess</h3>
<p>awk虽然强大，但是有些数据仍然不方便处理，这时可将数据交给Shell命令去帮助处理，然后再从Shell命令的执行结果中取回处理后的数据继续awk处理。</p>
<p>awk通过<code>|&amp;</code>符号来支持coproc。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk_print[f] &quot;something&quot; |&amp; Shell_Cmd</span><br><span class="line">Shell_Cmd |&amp; getline [var]</span><br></pre></td></tr></table></figure>
<p>这表示awk通过print输出的数据将传递给Shell的命令Shell_Cmd去执行，然后awk再从Shell_Cmd的执行结果中取回Shell_Cmd产生的数据。</p>
<h2 id="十、awk-输出操作🐸">十、awk 输出操作🐸</h2>
<h3 id="1、print">1、print</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print $1,$2,$3&#125;&#x27;</span> a.txt</span><br><span class="line">awk <span class="string">&#x27;&#123;print ($1,$2,$3)&#125;&#x27;</span> a.txt</span><br></pre></td></tr></table></figure>
<p>逗号分隔要打印的字段列表，各字段都<strong>会自动转换成字符串格式</strong>，然后通过预定义变量OFS(output field separator)的值(其默认值为空格)连接各字段进行输出。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;&#123;print $1,$2,$3&#125;&#x27;</span> a.txt            </span><br><span class="line">ID name gender</span><br><span class="line">1 Bob male</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;OFS=&quot;---&quot;&#125;&#123;print $1,$2,$3&#125;&#x27;</span> a.txt </span><br><span class="line">ID---name---gender</span><br><span class="line">1---Bob---male</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>print要输出的数据称为输出记录，在print输出时会自动在尾部加上输出记录分隔符，输出记录分隔符的预定义变量为ORS，其默认值为<code>\n</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;OFS=&quot;---&quot;;ORS=&quot;_\n&quot;&#125;&#123;print ($1,$2,$3)&#125;&#x27;</span> a.txt </span><br><span class="line">ID---name---gender_</span><br><span class="line">1---Bob---male_</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>括号可省略，但如果要打印的元素中包含了特殊符号<code>&gt;</code>，则必须使用括号包围(如<code>print(&quot;a&quot; &gt; &quot;A&quot;)</code>)，因为它是输出重定向符号。</p>
<p>如果省略参数，即<code>print;</code>等价于<code>print $0;</code>。</p>
<h3 id="print输出数值">print输出数值</h3>
<p>print在输出数据时，总是会先转换成字符串再输出。</p>
<p>对于数值而言，可以自定义转换成字符串的格式，例如使用sprintf()进行格式化。</p>
<p>print在自动转换数值（专指小数）为字符串的时候，采用预定义变量OFMT（Output format）定义的格式按照sprintf()相同的方式进行格式化。OFMT默认值为<code>%.6g</code>，表示有效位(整数部分加小数部分)最多为6。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;print 3.12432623&#125;&#x27;</span></span><br><span class="line">3.12433</span><br></pre></td></tr></table></figure>
<p>可以修改OFMT，来自定义数值转换为字符串时的格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化到小数点后2为，小数点第3位数值大于等于5，会四舍五入进一位。</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;OFMT=&quot;%.2f&quot; ;print 3.1415926 &#125;&#x27;</span></span><br><span class="line">3.14</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化为整数，不会四舍五入。</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;OFMT=&quot;%d&quot; ;print 3.1415926 &#125;&#x27;</span></span><br><span class="line">3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 格式化为整数，会四舍五入。</span></span><br><span class="line">$ awk <span class="string">&#x27;BEGIN&#123;OFMT=&quot;%.0f&quot;;print 3.99989&#125;&#x27;</span> </span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h3 id="2、printf">2、printf</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf format, item1, item2, ...</span><br></pre></td></tr></table></figure>
<p>格式化字符：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%c</td>
<td>将ASCII码转换为字符，示例：<code>awk &quot;BEGIN&#123;printf \&quot;%c\&quot;,65&#125;&quot;</code> 输出 <code>A</code></td>
</tr>
<tr>
<td>%d，%i</td>
<td>转换为整数，直接截断而不会四舍五入，示例：<code> awk &quot;BEGIN&#123;printf \&quot;%d\&quot;,3.1415&#125;&quot;</code> 输出<code>3</code></td>
</tr>
<tr>
<td>%e，%E</td>
<td>科学计数法方式输出数值</td>
</tr>
<tr>
<td>%f，%F</td>
<td>浮点数方式输出，会四舍五入，示例：<code>awk &quot;BEGIN&#123;printf \&quot;%.2f\&quot;,1.379&#125;&quot;</code>输出1.38</td>
</tr>
<tr>
<td>%g，%G</td>
<td>输出为浮点数，或科学计数法格式</td>
</tr>
<tr>
<td>%o</td>
<td>将数字识别为8进制，然后转换为10进制，再缓缓为字符串输出</td>
</tr>
<tr>
<td>%s</td>
<td>输出字符串</td>
</tr>
<tr>
<td>%x，%X</td>
<td>经数字识别为16进制，然后再转换为10进制，再转换为自负床输出</td>
</tr>
<tr>
<td>%%</td>
<td>输出百分号%</td>
</tr>
</tbody>
</table>
<h3 id="3、sprintf">3、sprintf()</h3>
<p>sprintf()采用和printf相同的方式格式化字符串，但是它不会输出格式化后的字符串，而是返回格式化后的字符串。所以，可以将格式化后的字符串赋值给某个变量。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        a = sprintf(&quot;%03d&quot;, 12.34)</span><br><span class="line">        print a  # 012</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="4、stdin、stdout、stderr">4、stdin、stdout、stderr</h3>
<p>awk重定向时可以直接使用<code>/dev/stdin</code>、<code>/dev/stdout</code>和<code>/dev/stderr</code>。还可以直接使用某个已打开的文件描述符<code>/dev/fd/N</code>。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;print &quot;something OK&quot; &gt; &quot;/dev/stdout&quot;&#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN&#123;print &quot;something wrong&quot; &gt; &quot;/dev/stderr&quot;&#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN&#123;print &quot;something wrong&quot; | &quot;cat &gt;&amp;2&quot;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">awk &#x27;BEGIN&#123;getline &lt; &quot;/dev/stdin&quot;;print $0&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">exec</span> 4&lt;&gt; a.txt</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;while((getline &lt; &quot;/dev/fd/4&quot;)&gt;0)&#123;print $0&#125;&#125;&#x27;</span></span></span><br></pre></td></tr></table></figure>
<h2 id="十一、close-关闭句柄🐳">十一、close 关闭句柄🐳</h2>
<p>​	有时我们需要用shell脚本处理一些文件，通常我们会使用awk这个强大的可编程命令来处理文本文件，当我们在一次awk调用中处理很多文件时，如果没有正确的关闭打开的文件和管道，则会造成文件句柄泄露，awk命令会报错，我们通过以下测试说明这个问题，并看看如何正确的使用close命令解决这个问题。</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">close</span>(filename)</span><br><span class="line"><span class="built_in">close</span>(cmd,[<span class="built_in">from</span> | <span class="built_in">to</span>])  <span class="comment"># to参数只用于coprocess的第一个阶段</span></span><br></pre></td></tr></table></figure>
<p>如果close()关闭的对象不存在，awk不会报错，仅仅只是让其返回一个负数返回值。</p>
<p>close()有两个基本作用：</p>
<ul>
<li>关闭文件，丢弃已有的文件偏移指针，下次再读取文件，将只能重新打开文件，重开文件会从文件最开头处开始读取。</li>
<li>发送EOF标记</li>
</ul>
<p>awk中任何文件都只会在第一次使用时打开，之后都不会再重新打开。只有关闭之后，再使用才会重新打开。</p>
<p>我们先用ulimit命令查看一个进程最多可以打开多少个文件句柄，通常是1024。：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n</span><br></pre></td></tr></table></figure>
<p>生成一批测试文件，数量超过1024，这里我们生成了10000个文件用于测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir test</span><br><span class="line">cd test</span><br><span class="line">for ((i=0; i &lt; 10000; ++i)); do </span><br><span class="line">    filename=$(printf &quot;file%04d&quot; $i); </span><br><span class="line">    echo $filename; </span><br><span class="line">    for ((j=0; j &lt; 10; ++j)); do  </span><br><span class="line">        echo line$j &gt;&gt; $&#123;filename&#125;; </span><br><span class="line">    done; </span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>我们来看看下面这个awk命令的执行情况：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ls file* | awk &#x27;BEGIN &#123;</span><br><span class="line">    count=0;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    file=$0;</span><br><span class="line">    if (getline line &lt;file)</span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">END &#123;</span><br><span class="line">    print count;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>这个命令用于统计非空文件的个数，当然这不是最好的方法，在这里只用于awk打开文件的测试，命令执行时会提示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk: cmd. line:6: (FILENAME=- FNR=1022) fatal: too many pipes or input files open</span><br></pre></td></tr></table></figure>
<p>可见打开了太多的文件，可以在if语句后面加上close来关闭打开的文件以解决这个问题，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ls file* | awk &#x27;BEGIN &#123;</span><br><span class="line">    count=0;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    file=$0;</span><br><span class="line">    if (getline line &lt;file)</span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    close(file);</span><br><span class="line">&#125;</span><br><span class="line">END &#123;</span><br><span class="line">    print count;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>除了打开文件占用文件句柄之外的另一种占用文件句柄的情况就是调用shell命令并用管道处理，这种情况也要用close关闭打开管道，close的参数必须与打开管道的命令字符串完全一致，例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ls file* | awk &#x27;BEGIN &#123;</span><br><span class="line">    count=0;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    file=$0;</span><br><span class="line">    while (&quot;cat &quot;file | getline line)</span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    close(&quot;cat &quot;file);</span><br><span class="line">&#125;</span><br><span class="line">END &#123;</span><br><span class="line">    print count;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>这个问题有一个例外，就是我们用getline读入一个文件时，遇到文件结束（getline失败时）awk会自动关闭这个文件，不需要主动close，例如以下统计所有文件行数的命令是可以正确执行的，这个便利并不适用于管道，如上例所示，管道还是需要主动关闭的：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ls file* | awk &#x27;BEGIN &#123;</span><br><span class="line">    count=0;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    file=$0;</span><br><span class="line">    while (getline line &lt;file)</span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">END &#123;</span><br><span class="line">    print count;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="十二、awk-变量🐋">十二、awk 变量🐋</h2>
<h3 id="1、变量赋值">1、变量赋值</h3>
<p>awk中的变量赋值语句也可以看作是一个<strong>有返回值</strong>的表达式。</p>
<p>例如，<code>a=3</code>赋值完成后返回3，同时变量a也被设置为3。</p>
<p>基于这个特点，有两点用法：</p>
<ul>
<li>可以<code>x=y=z=5</code>，等价于<code>z=5 y=5 x=5</code></li>
<li>可以将赋值语句放在任意允许使用表达式的地方
<ul>
<li><code>x != (y = 1)</code></li>
<li><code>awk 'BEGIN&#123;print (a=4);print a&#125;'</code></li>
</ul>
</li>
</ul>
<p>问题：<code>a=1;arr[a+=2] = (a=a+6)</code>是怎么赋值的，对应元素结果等于？<code>arr[3]=7</code>。但不要这么做，因为不同awk的赋值语句左右两边的评估顺序有可能不同。</p>
<h3 id="2、awk中声明变量的位置">2、awk中声明变量的位置</h3>
<ol>
<li>在BEGIN或main或END代码段中直接引用或赋值</li>
<li>使用<code>-v var=val</code>选项，可定义多个，必须放在awk代码的前面
<ul>
<li>它的变量声明早于BEGIN块</li>
<li>普通变量：<code>awk -v age=123 'BEGIN&#123;print age&#125;'</code></li>
<li>使用shell变量赋值：<code>awk -v age=$age 'BEGIN&#123;print age&#125;'</code></li>
</ul>
</li>
<li>在awk代码后面使用<code>var=val</code>参数
<ul>
<li>它的变量声明在BEGIN之后</li>
<li><code>awk '&#123;print n&#125;' n=3 a.txt n=4 b.txt</code></li>
<li><code>awk '&#123;print $1&#125;' FS=' ' a.txt FS=&quot;:&quot; /etc/passwd</code></li>
<li>使用Shell变量赋值：<code>awk '&#123;print age&#125;' age=$age a.txt</code></li>
</ul>
</li>
</ol>
<h2 id="十三、awk-流程控制🐬">十三、awk 流程控制🐬</h2>
<h3 id="1、if…else">1、if…else</h3>
<p>语法如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">单独的<span class="keyword">if</span></span></span><br><span class="line">if(cond)&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">if...else</span></span><br><span class="line">if(cond1)&#123;</span><br><span class="line">    statements1</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    statements2</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">if...else if...else</span></span><br><span class="line">if(cond1)&#123;</span><br><span class="line">    statements1</span><br><span class="line">&#125; else if(cond2)&#123;</span><br><span class="line">    statements2</span><br><span class="line">&#125; else if(cond3)&#123;</span><br><span class="line">    statements3</span><br><span class="line">&#125; else&#123;</span><br><span class="line">    statements4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;if($1&lt;5)&#123;print $1&#125;&#125;&#x27; a.txt</span><br><span class="line"></span><br><span class="line">awk &#x27;&#123;if($1&lt;5)&#123;print $1&#125; else &#123;print 666&#125;&#125;&#x27; a.txt</span><br><span class="line"></span><br><span class="line">awk &#x27;/^[0-9]/&#123;if($1&lt;5)&#123;print $1&#125;else if ($1&lt;8&amp;&amp;$1&gt;=5)&#123;print 333&#125;else &#123;print 666&#125;&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<h3 id="2、三目运算符">2、三目运算符?:</h3>
<p>语法如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">expr1 ? expr2 : expr3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">相当于</span></span><br><span class="line">if(expr1)&#123;</span><br><span class="line">    expr2</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    expr3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行流程：表达式1为真返回表达式2，表达式1为假返回表达式3，示例如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;a=50;b=(a&gt;60) ? &quot;及格&quot; : &quot;不及格&quot;;print(b)&#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN&#123;a=50; a&gt;60 ? b=&quot;及格&quot; : b=&quot;不及格&quot;;print(b)&#125;&#x27;</span><br><span class="line">awk &#x27;/^[0-9]/&#123;$4&gt;23 ? b=&quot;old&quot; : b=&quot;young&quot;;print(b)&#125;&#x27; a.txt </span><br></pre></td></tr></table></figure>
<h3 id="3、switch…case">3、switch…case</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">switch (expression) &#123;</span><br><span class="line">    case value1|regex1 : statements1</span><br><span class="line">    case value2|regex2 : statements2</span><br><span class="line">    case value3|regex3 : statements3</span><br><span class="line">    ...</span><br><span class="line">    [ default: statement ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>awk 中的switch分支语句功能较弱，只能进行等值比较或正则匹配。</p>
<p>各分支结尾需使用break来终止。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">&#123;</span><br><span class="line">    switch($1)&#123;</span><br><span class="line">        case 1:</span><br><span class="line">            print(&quot;Monday&quot;)</span><br><span class="line">            break</span><br><span class="line">        case 2:</span><br><span class="line">            print(&quot;Tuesday&quot;)</span><br><span class="line">            break</span><br><span class="line">        case 3:</span><br><span class="line">            print(&quot;Wednesday&quot;)</span><br><span class="line">            break</span><br><span class="line">        case 4:</span><br><span class="line">            print(&quot;Thursday&quot;)</span><br><span class="line">            break</span><br><span class="line">        case 5:</span><br><span class="line">            print(&quot;Friday&quot;)</span><br><span class="line">            break</span><br><span class="line">        case 6:</span><br><span class="line">            print(&quot;Saturday&quot;)</span><br><span class="line">            break</span><br><span class="line">        case 7:</span><br><span class="line">            print(&quot;Sunday&quot;)</span><br><span class="line">            break</span><br><span class="line">        default:</span><br><span class="line">            print(&quot;What day?&quot;)</span><br><span class="line">            break</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>分支穿透：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;    </span><br><span class="line">    switch($1)&#123;</span><br><span class="line">        case 1:</span><br><span class="line">        case 2:</span><br><span class="line">        case 3:</span><br><span class="line">        case 4:</span><br><span class="line">        case 5:</span><br><span class="line">            print(&quot;Weekday&quot;)</span><br><span class="line">            break</span><br><span class="line">        case 6:</span><br><span class="line">        case 7:</span><br><span class="line">            print(&quot;Weekend&quot;)</span><br><span class="line">            break</span><br><span class="line">        default:</span><br><span class="line">            print(&quot;What day?&quot;)</span><br><span class="line">            break</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<h3 id="4、while和do…while">4、while和do…while</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">while(condition)&#123;</span><br><span class="line">    statements</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">do &#123;</span><br><span class="line">    statements</span><br><span class="line">&#125; while(condition)</span><br></pre></td></tr></table></figure>
<p>while先判断条件再决定是否执行statements，do…while先执行statements再判断条件决定下次是否再执行statements。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;i=0;while(i&lt;5)&#123;print i;i++&#125;&#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN&#123;i=0;do &#123;print i;i++&#125; while(i&lt;5)&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>多数时候，while和do…while是等价的，但如果第一次条件判断失败，则do…while和while不同。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;i=0;while(i == 2)&#123;print i;i++&#125;&#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN&#123;i=0;do &#123;print i;i++&#125; while(i ==2 )&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>所以，while可能一次也不会执行，do…while至少会执行一次。</p>
<p>一般用while，do…while相比while来说，用的频率非常低。</p>
<h3 id="5、for循环">5、for循环</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for (expr1; expr2; expr3) &#123;</span><br><span class="line">    statement</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for (idx in array) &#123;</span><br><span class="line">    statement</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;for(i=0;i&lt;10;i++)&#123;print i&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="6、break和continue">6、break和continue</h3>
<p>break可退出for、while、do…while、switch语句。</p>
<p>continue可让for、while、do…while进入下一轮循环。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">BEGIN&#123;</span><br><span class="line">  for(i=0;i&lt;10;i++)&#123;</span><br><span class="line">    if(i==5)&#123;</span><br><span class="line">      break</span><br><span class="line">    &#125;</span><br><span class="line">    print(i)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash"><span class="built_in">continue</span></span></span><br><span class="line">  for(i=0;i&lt;10;i++)&#123;</span><br><span class="line">    if(i==5)continue</span><br><span class="line">    print(i)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="7、next和nextfile">7、next和nextfile</h3>
<p>next会在当前语句处立即停止后续操作，并读取下一行，进入循环顶部。</p>
<p>例如，输出除第3行外的所有行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;NR==3&#123;next&#125;&#123;print&#125;&#x27; a.txt</span><br><span class="line">awk &#x27;NR==3&#123;getline&#125;&#123;print&#125;&#x27; a.txt</span><br></pre></td></tr></table></figure>
<p>nextfile会在当前语句处立即停止后续操作，并直接读取下一个文件，并进入循环顶部。</p>
<p>例如，每个文件只输出前2行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;FNR==3&#123;nextfile&#125;&#123;print&#125;&#x27; a.txt a.txt</span><br></pre></td></tr></table></figure>
<h3 id="8、exit">8、exit</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit [exit_code]</span><br></pre></td></tr></table></figure>
<p>直接退出awk程序。</p>
<p>注意，END语句块也是exit操作的一部分，所以在BEGIN或main段中执行exit操作，也会执行END语句块。</p>
<p>如果exit在END语句块中执行，则立即退出。</p>
<p>所以，如果真的想直接退出整个awk，则可以先设置一个flag变量，然后在END语句块的开头检查这个变量再exit。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">BEGIN&#123;</span><br><span class="line">    ...code...</span><br><span class="line">    if(cond)&#123;</span><br><span class="line">        flag=1</span><br><span class="line">        exit</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&#125;</span><br><span class="line">END&#123;</span><br><span class="line">    if(flag)&#123;</span><br><span class="line">        exit</span><br><span class="line">    &#125;</span><br><span class="line">    ...code...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;print &quot;begin&quot;;flag=1;exit&#125;</span><br><span class="line">    &#123;&#125;</span><br><span class="line">    END&#123;if(flag)&#123;exit&#125;;print &quot;end2&quot;&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>exit可以指定退出状态码，如果触发了两次exit操作，即BEGIN或main中的exit触发了END中的exit，且END中的exit没有指定退出状态码时，则采取前一个退出状态码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;flag=1;exit 2&#125;&#123;&#125;END&#123;if(flag)&#123;exit 1&#125;&#125;&#x27;</span></span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $?</span></span><br><span class="line">1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;flag=1;exit 2&#125;&#123;&#125;END&#123;if(flag)&#123;exit&#125;&#125;&#x27;</span></span>   </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $?</span></span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<h2 id="十四、数组🐟">十四、数组🐟</h2>
<p>awk数组特性：</p>
<ul>
<li>awk的数组是关联数组(即key/value方式的hash数据结构)，索引下标可为数值(甚至是负数、小数等)，也可为字符串
<ul>
<li>在内部，awk数组的索引全都是字符串，即使是数值索引在使用时内部也会转换成字符串</li>
<li>awk的数组元素的顺序和元素插入时的顺序很可能是不相同的</li>
</ul>
</li>
<li>awk数组支持数组的数组</li>
</ul>
<h3 id="1、awk访问、赋值数组元素">1、awk访问、赋值数组元素</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arr[idx]</span><br><span class="line">arr[idx] = value</span><br></pre></td></tr></table></figure>
<p>索引可以是整数、负数、0、小数、字符串。如果是数值索引，会按照CONVFMT变量指定的格式先转换成字符串。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    arr[1]   = 11</span><br><span class="line">    arr[&quot;1&quot;] = 111</span><br><span class="line">    arr[&quot;a&quot;] = &quot;aa&quot;</span><br><span class="line">    arr[-1]  = -11</span><br><span class="line">    arr[4.3] = 4.33</span><br><span class="line">    print arr[1]     # 111</span><br><span class="line">    print arr[&quot;1&quot;]   # 111</span><br><span class="line">    print arr[&quot;a&quot;]   # aa</span><br><span class="line">    print arr[-1]    # -11</span><br><span class="line">    print arr[4.3]   # 4.33</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p><strong>通过索引的方式访问数组中不存在的元素时，会返回空字符串，同时会创建这个元素并将其值设置为空字符串</strong>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    arr[-1]=3;</span><br><span class="line">    print length(arr);  # 1</span><br><span class="line">    print arr[1];</span><br><span class="line">    print length(arr)   # 2</span><br><span class="line">  &#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="2、awk数组长度">2、awk数组长度</h3>
<p>awk提供了<code>length()</code>函数来获取数组的元素个数，它也可以用于获取字符串的字符数量。还可以获取数值转换成字符串后的字符数量。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;arr[1]=1;arr[2]=2;print length(arr);print length(&quot;hello&quot;)&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="3、awk删除数组元素">3、awk删除数组元素</h3>
<ul>
<li>delete arr[idx]：删除数组 arr[idx]元素，删除不存在的元素不会报错</li>
<li><code>delete arr</code>：删除数组所有元素</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;arr[1]=1;arr[2]=2;arr[3]=3;delete arr[2];print length(arr)&#125;&#x27;</span></span></span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<h3 id="4、awk检测是否是数组">4、awk检测是否是数组</h3>
<p><code>isarray(arr)</code>可用于检测arr是否是数组，如果是数组则返回1，否则返回0。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">    arr[1]=1;</span><br><span class="line">    print isarray(arr);</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="5、awk测试元素是否在数组中">5、awk测试元素是否在数组中</h3>
<p>不要使用下面的方式来测试元素是否在数组中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(arr[&quot;x&quot;] != &quot;&quot;)&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>这有两个问题：</p>
<ul>
<li>如果不存在arr[“x”]，则会立即创建该元素，并将其值设置为空字符串</li>
<li>有些元素的值本身就是空字符串</li>
</ul>
<p>应当使用数组成员测试操作符in来测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意，idx不要使用index，它是一个内置函数</span></span><br><span class="line">if (idx in arr)&#123;...&#125;</span><br></pre></td></tr></table></figure>
<p>它会测试索引idx是否在数组中，如果存在则返回1，不存在则返回0。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        arr[1]=1;</span><br><span class="line">        arr[2]=2;</span><br><span class="line">        arr[3]=3;</span><br><span class="line">        arr[1]=&quot;&quot;;</span><br><span class="line">        delete arr[2];</span><br><span class="line">        print (1 in arr);  # 1</span><br><span class="line">        print (2 in arr);  # 0</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="6、awk遍历数组">6、awk遍历数组</h3>
<p>awk提供了一种for变体来遍历数组：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for(idx in arr)&#123;print arr[idx]&#125;</span><br></pre></td></tr></table></figure>
<p>因为awk数组是关联数组，元素是不连续的，也就是说没有顺序。遍历awk数组时，顺序是不可预测的。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        arr[&quot;one&quot;] = 1</span><br><span class="line">        arr[&quot;two&quot;] = 2</span><br><span class="line">        arr[&quot;three&quot;] = 3</span><br><span class="line">        arr[&quot;four&quot;] = 4</span><br><span class="line">        arr[&quot;five&quot;] = 5</span><br><span class="line">        </span><br><span class="line">        for(i in arr)&#123;</span><br><span class="line">            print i &quot; -&gt; &quot; arr[i]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>此外，不要随意使用<code>for(i=0;i&lt;length(arr);i++)</code>来遍历数组，因为awk数组是关联数组。但如果已经明确知道数组的所有元素索引都位于某个数值范围内，则可以使用该方式进行遍历。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        arr[1] = &quot;one&quot;</span><br><span class="line">        arr[2] = &quot;two&quot;</span><br><span class="line">        arr[3] = &quot;three&quot;</span><br><span class="line">        arr[4] = &quot;four&quot;</span><br><span class="line">        arr[5] = &quot;five&quot;</span><br><span class="line">        arr[10]= &quot;ten&quot;</span><br><span class="line"></span><br><span class="line">        for(i=0;i&lt;=10;i++)&#123;</span><br><span class="line">            if(i in arr)&#123;</span><br><span class="line">                print arr[i]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="7、awk-子数组">7、awk 子数组</h3>
<p>子数组是指数组中的元素也是一个数组，即Array of Array，它也称为子数组(subarray)。</p>
<p>awk也支持子数组，在效果上即是嵌套数组或多维数组。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a[1][1] = 11</span><br><span class="line">a[1][2] = 12</span><br><span class="line">a[1][3] = 13</span><br><span class="line">a[2][1] = 21</span><br><span class="line">a[2][2] = 22</span><br><span class="line">a[2][3] = 23</span><br><span class="line">a[2][4][1] = 241</span><br><span class="line">a[2][4][2] = 242</span><br><span class="line">a[2][4][1] = 241</span><br><span class="line">a[2][4][3] = 243</span><br></pre></td></tr></table></figure>
<p>通过如下方式遍历二维数组：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for(i in a)&#123;</span><br><span class="line">    for (j in a[i])&#123;</span><br><span class="line">        if(isarray(a[i][j]))&#123;</span><br><span class="line">            continue</span><br><span class="line">        &#125;</span><br><span class="line">        print a[i][j]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8、awk指定数组遍历顺序">8、awk指定数组遍历顺序</h3>
<p>由于awk数组是关联数组，默认情况下，<code>for(idx in arr)</code>遍历数组时顺序是不可预测的。</p>
<p>但是gawk提供了<code>PROCINFO[&quot;sorted_in&quot;]</code>来指定遍历的元素顺序。它可以设置为两种类型的值：</p>
<ul>
<li>设置为用户自定义函数</li>
<li>设置为下面这些awk预定义好的值：
<ul>
<li><code>@unsorted</code>：默认值，遍历时无序</li>
<li><code>@ind_str_asc</code>：索引按字符串比较方式升序遍历</li>
<li><code>@ind_str_desc</code>：索引按字符串比较方式降序遍历</li>
<li><code>@ind_num_asc</code>：索引强制按照数值比较方式升序遍历。所以无法转换为数值的字符串索引将当作数值0进行比较</li>
<li><code>@ind_num_desc</code>：索引强制按照数值比较方式降序遍历。所以无法转换为数值的字符串索引将当作数值0进行比较</li>
<li><code>@val_type_asc</code>：按值升序比较，此外数值类型出现在前面，接着是字符串类型，最后是数组类(即认为<code>num&lt;str&lt;arr</code>)</li>
<li><code>@val_type_desc</code>：按值降序比较，此外数组类型出现在前面，接着是字符串类型，最后是数值型(即认为<code>num&lt;str&lt;arr</code>)</li>
<li><code>@val_str_asc</code>：按值升序比较，数值转换成字符串再比较，而数组出现在尾部(即认<code>str&lt;arr</code>)</li>
<li><code>@val_str_desc</code>：按值降序比较，数值转换成字符串再比较，而数组出现在头部(即认<code>str&lt;arr</code>)</li>
<li><code>@val_num_asc</code>：按值升序比较，字符串转换成数值再比较，而数组出现在尾部(即认<code>num&lt;arr</code>)</li>
<li><code>@val_num_desc</code>：按值降序比较，字符串转换成数值再比较，而数组出现在头部(即认为<code>num&lt;arr</code>)</li>
</ul>
</li>
</ul>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    arr[1] = &quot;one&quot;</span><br><span class="line">    arr[2] = &quot;two&quot;</span><br><span class="line">    arr[3] = &quot;three&quot;</span><br><span class="line">    arr[&quot;a&quot;] =&quot;aa&quot;</span><br><span class="line">    arr[&quot;b&quot;] =&quot;bb&quot;</span><br><span class="line">    arr[10]= &quot;ten&quot;</span><br><span class="line"></span><br><span class="line">    #PROCINFO[&quot;sorted_in&quot;] = &quot;@ind_num_asc&quot;</span><br><span class="line">    #PROCINFO[&quot;sorted_in&quot;] = &quot;@ind_str_asc&quot;</span><br><span class="line">    PROCINFO[&quot;sorted_in&quot;] = &quot;@val_str_asc&quot;</span><br><span class="line">    for(idx in arr)&#123;</span><br><span class="line">      print idx &quot; -&gt; &quot; arr[idx]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出如下：</span></span><br><span class="line">a -&gt; aa</span><br><span class="line">b -&gt; bb</span><br><span class="line">1 -&gt; one</span><br><span class="line">2 -&gt; two</span><br><span class="line">3 -&gt; three</span><br><span class="line">10 -&gt; ten</span><br></pre></td></tr></table></figure>
<h2 id="十五、awk-自定义函数🐠">十五、awk 自定义函数🐠</h2>
<p>可以定义一个函数将多个操作整合在一起。函数定义之后，可以到处多次调用，从而方便复用。</p>
<h3 id="1、函数定义">1、函数定义</h3>
<p>使用function关键字来定义函数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function func_name([parameters])&#123;</span><br><span class="line">    function_body</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于gawk来说，也支持func关键字来定义函数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func func_name()&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>函数可以定义在下面使用下划线的地方：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;_ BEGIN&#123;&#125; _ MAIN&#123;&#125; _ END&#123;&#125; _&#x27;</span><br></pre></td></tr></table></figure>
<p>无论函数定义在哪里，都能在任何地方调用，因为awk在BEGIN之前，会先编译awk代码为内部格式，在这个阶段会将所有函数都预定义好。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        f()</span><br><span class="line">        f()</span><br><span class="line">        f()</span><br><span class="line">    &#125;</span><br><span class="line">    function f()&#123;</span><br><span class="line">        print &quot;星期一&quot;</span><br><span class="line">        print &quot;星期二&quot;</span><br><span class="line">        print &quot;星期三&quot;</span><br><span class="line">        print &quot;星期四&quot;</span><br><span class="line">        print &quot;星期五&quot;</span><br><span class="line">        print &quot;星期六&quot;</span><br><span class="line">        print &quot;星期日&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="2、awk函数的return语句">2、awk函数的return语句</h3>
<p>如果想要让函数有返回值，那么需要在函数中使用return语句。</p>
<p>return语句也可以用来立即结束函数的执行。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    function add()&#123;</span><br><span class="line">        return 40</span><br><span class="line">    &#125;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        print add()</span><br><span class="line">        res = add() </span><br><span class="line">        print res</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出</span></span><br><span class="line">40</span><br><span class="line">40</span><br></pre></td></tr></table></figure>
<p>如果不使用return或return没有参数，则返回值为空，即空字符串。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  function f1()&#123;        &#125;</span><br><span class="line">  function f2()&#123;return  &#125;</span><br><span class="line">  function f3()&#123;return 3&#125;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    print &quot;-&quot;f1()&quot;-&quot;</span><br><span class="line">    print &quot;-&quot;f2()&quot;-&quot;</span><br><span class="line">    print &quot;-&quot;f3()&quot;-&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出</span></span><br><span class="line">--</span><br><span class="line">--</span><br><span class="line">-3-</span><br></pre></td></tr></table></figure>
<h3 id="3、awk函数参数">3、awk函数参数</h3>
<p>为了让函数和调用者能够进行数据的交互，可以使用参数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  function f(a,b)&#123;</span><br><span class="line">    print a</span><br><span class="line">    print b</span><br><span class="line">    return a+b</span><br><span class="line">  &#125;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    x=10</span><br><span class="line">    y=20</span><br><span class="line">    res = f(x,y)</span><br><span class="line">    print res</span><br><span class="line">    print f(x,y)</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>例如，实现一个重复某字符串指定次数的函数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    function repeat(str,cnt,res_str)&#123;</span><br><span class="line">        for(i=0;i&lt;cnt;i++)&#123;</span><br><span class="line">            res_str = res_str&quot;&quot;str</span><br><span class="line">        &#125;</span><br><span class="line">        return res_str</span><br><span class="line">    &#125;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        print repeat(&quot;abc&quot;,3)</span><br><span class="line">        print repeat(&quot;-&quot;,30)</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出如下：</span></span><br><span class="line">abcabcabc</span><br><span class="line">------------------------------</span><br></pre></td></tr></table></figure>
<p>调用函数时，实参数量可以比形参数量少，也可以比形参数量多。但是，在多于形参数量时会给出警告信息。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    function repeat(str,cnt,res_str)&#123;</span><br><span class="line">        for(i=0;i&lt;cnt;i++)&#123;</span><br><span class="line">            res_str = res_str&quot;&quot;str</span><br><span class="line">        &#125;</span><br><span class="line">        return res_str</span><br><span class="line">    &#125;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        print repeat(&quot;abc&quot;,3)</span><br><span class="line">        print repeat(&quot;-&quot;,30,1,2,3,4)</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出如下</span></span><br><span class="line">abcabcabc</span><br><span class="line">awk: cmd. line:10: warning: function `repeat&#x27; called with more arguments than declared</span><br><span class="line">1------------------------------</span><br></pre></td></tr></table></figure>
<h3 id="4、awk函数参数数据类型冲突问题">4、awk函数参数数据类型冲突问题</h3>
<p>如果函数内部使用参数的类型和函数外部变量的类型不一致，会出现数据类型不同而导致报错。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    function f(a)&#123;</span><br><span class="line">        a[1]=30</span><br><span class="line">    &#125;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        a=&quot;hello world&quot;</span><br><span class="line">        f(a)   # 报错</span><br><span class="line"></span><br><span class="line">        f(x)</span><br><span class="line">        x=10   # 报错</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出报错如下：</span></span><br><span class="line">awk: cmd. line:3: fatal: attempt to use scalar parameter `a&#x27; as an array</span><br></pre></td></tr></table></figure>
<p>函数内部参数对应的是数组，那么外面对应的也必须是数组类型。</p>
<h3 id="5、awk参数按值传递还是按引用传递">5、awk参数按值传递还是按引用传递</h3>
<p>在调用函数时，将数据作为函数参数传递给函数时，有两种传递方式：</p>
<ul>
<li>传递普通变量时，是按值拷贝传递
<ul>
<li>直接拷贝普通变量的<strong>值</strong>到函数中</li>
<li>函数内部修改不会影响到外部</li>
</ul>
</li>
<li>传递数组时，是按引用传递
<ul>
<li>函数内部修改会影响到外部</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">传递普通变量：按值拷贝</span></span><br><span class="line">awk &#x27;</span><br><span class="line">  function modify(a)&#123;</span><br><span class="line">    a=30</span><br><span class="line">    print a</span><br><span class="line">  &#125;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    a=40</span><br><span class="line">    modify(a)</span><br><span class="line">    print a</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出如下：</span></span><br><span class="line">30</span><br><span class="line">40</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">传递数组：按引用拷贝</span></span><br><span class="line">awk &#x27;</span><br><span class="line">  function modify(a)&#123;</span><br><span class="line">    a[1]=20</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    a[1]=10</span><br><span class="line">    modify(a)</span><br><span class="line">    print a[1]</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">输出如下</span></span><br><span class="line">20</span><br></pre></td></tr></table></figure>
<h3 id="6、awk作用域问题">6、awk作用域问题</h3>
<p>awk只有在函数参数中才是局部变量，其它地方定义的变量均为全局变量。</p>
<p><strong>函数内部新增的变量是全局变量</strong>，会影响到全局，所以在函数退出后仍然能访问。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  function f()&#123;</span><br><span class="line">    a=30  # 新增的变量，是全局变量</span><br><span class="line">    print &quot;in f: &quot; a</span><br><span class="line">  &#125;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    a=40</span><br><span class="line">    f()</span><br><span class="line">    print a  # 30</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>函数参数会遮掩全局同名变量，所以在函数执行时，无法访问到或操作与参数同名的全局变量，函数退出时会自动撤掉遮掩，这时才能访问全局变量。所以，参数具有局部效果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  function f(a)&#123;</span><br><span class="line">    print a    # 50，按值拷贝，和全局a已经没有关系</span><br><span class="line">    a=40</span><br><span class="line">    print a    # 40</span><br><span class="line">  &#125;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    a=50</span><br><span class="line">    f(a)</span><br><span class="line">    print a     # 50，函数退出，重新访问全局变量</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>由于函数内部新增变量均为全局变量，awk也没有提供关键字来修饰一个变量使其成为局部变量。所以，awk只能将本该出现在函数体内的局部变量放在参数列表中，只要调用函数时不要为这些参数传递数据即可，从而实现局部变量的效果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  function f(a,b       ,c,d)&#123;</span><br><span class="line">  </span><br><span class="line">    # a,b是参数，调用时需传递两个参数</span><br><span class="line">    # c,d是局部变量，调用时不要给c和d传递数据</span><br><span class="line">    a=30</span><br><span class="line">    b=40</span><br><span class="line">    c=50</span><br><span class="line">    d=60</span><br><span class="line">    e=70  # 全局变量</span><br><span class="line"></span><br><span class="line">    print a,b,c,d,e  # 30 40 50 60 70</span><br><span class="line">  &#125;</span><br><span class="line">  BEGIN&#123;</span><br><span class="line">    a=31</span><br><span class="line">    b=41</span><br><span class="line">    c=51</span><br><span class="line">    d=61</span><br><span class="line">    f(a,b)  # 调用函数时值传递两个参数</span><br><span class="line">    print a,b,c,d,e  # 31 41 51 61 70</span><br><span class="line">  &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>所以，awk对函数参数列表做了两类区分：</p>
<ul>
<li>arguments：调用函数时传递的参数</li>
<li>local variables：调用函数时省略的参数</li>
</ul>
<p>为了区分arguments和local variables，约定俗成的，将local variables放在一大堆空格后面来提示用户。例如<code>function name(a,b, c,d)</code>表示调用函数时，应当传递两个参数，c和d是本函数内部使用的局部变量，不要传递对应的参数。</p>
<p>区分参数和局部变量：</p>
<ul>
<li>参数提供了函数和它调用者进行数据交互的方式</li>
<li>局部变量是临时存放数据的地方</li>
</ul>
<p>arguments部分体现的是函数调用时传递的参数，这些参数在函数内部会遮掩全局同名变量。例如上面示例中，函数内部访问不了全局的a和b，所有对a和b的操作都是函数内部的，函数退出后才能重新访问全局a和b。因此，arguments也有局部特性。</p>
<p>local variables是awk实现真正局部变量的技巧，只是因为函数内部新增的变量都是全局变量，所以退而求其次将其放在参数列表上来实现局部变量。</p>
<h2 id="十六、awk数值类内置函数🌳">十六、awk数值类内置函数🌳</h2>
<h3 id="1、awk数值类内置函数">1、awk数值类内置函数</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int(expr)     截断为整数：int(123.45)和int(&quot;123abc&quot;)都返回123，int(&quot;a123&quot;)返回0</span><br><span class="line">sqrt(expr)    返回平方根</span><br><span class="line">rand()        返回[0,1)之间的随机数，默认使用srand(1)作为种子值</span><br><span class="line">srand([expr]) 设置rand()种子值，省略参数时将取当前时间的epoch值(精确到秒的epoch)作为种子值</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span></span><br><span class="line">0.0379114</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;srand();print rand()&#125;&#x27;</span></span></span><br><span class="line">0.0779783</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;srand(2);print rand()&#125;&#x27;</span></span></span><br><span class="line">0.893104</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">awk <span class="string">&#x27;BEGIN&#123;srand(2);print rand()&#125;&#x27;</span></span></span><br><span class="line">0.893104</span><br></pre></td></tr></table></figure>
<p>生成<code>[10,100]</code>之间的随机整数。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;srand();print 10+int(91*rand())&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="2、awk字符串类内置函数">2、awk字符串类内置函数</h3>
<p>注意，awk中涉及到<strong>字符索引的函数，索引位都是从1开始计算</strong>，和其它语言从0开始不一样。</p>
<h4 id="（1）基本函数">（1）基本函数</h4>
<ul>
<li>
<p><code>sprintf(format, expression1, ...)</code>：返回格式化后的字符串</p>
<ul>
<li><code>a=sprintf(&quot;%s\n&quot;,&quot;abc&quot;)</code></li>
</ul>
</li>
<li>
<p><code>length()</code>：返回字符串字符数量、数组元素数量、或数值转换为字符串后的字符数量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        print length(1.23)     # 4   # CONVFMT %.6g</span><br><span class="line"></span><br><span class="line">        print 1.234567         # 1.23457</span><br><span class="line">        print length(1.234567) # 7 </span><br><span class="line">        print length(122341223432.1213241234)  # 11</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>strtonum(str)</code>：将字符串转换为十进制数值</p>
<ul>
<li>如果str以0开头，则将其识别为8进制</li>
<li>如果str以0x或0X开头，则将其识别为16进制</li>
</ul>
</li>
<li>
<p><code>tolower(str)</code>：转换为小写</p>
</li>
<li>
<p><code>toupper(str)</code>：转换为大写</p>
</li>
<li>
<p><code>index(str,substr)</code>：从str中搜索substr(子串)，返回搜索到的索引位置(索引从1开始)，搜索不到则返回0</p>
</li>
</ul>
<h4 id="（2）awk-substr">（2）awk substr()</h4>
<ul>
<li><code>substr(string,start[,length])</code>：从string中截取子串</li>
</ul>
<p>start是截取的起始索引位(索引位从1开始而非0)，length表示截取的子串长度。如果省略length，则表示从start开始截取剩余所有字符。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        str=&quot;abcdefgh&quot;</span><br><span class="line">        print substr(str,3)   # cdefgh</span><br><span class="line">        print substr(str,3,3) # cde</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>如果start值小于1，则将其看作为1对待，如果start大于字符串的长度，则返回空字符串。</p>
<p>如果length小于或等于0，则返回空字符串。</p>
<h4 id="（3）awk-split-和patsplit">（3）awk split()和patsplit()</h4>
<ul>
<li><code>split(string, array [, fieldsep [, seps ] ])</code>：将字符串分割后保存到数组array中，数组索引从1开始存储。并返回分割得到的元素个数</li>
</ul>
<p>其中fieldsep指定分隔符，可以是正则表达式方式的。如果不指定该参数，则默认使用FS作为分隔符，而FS的默认值又是空格。</p>
<p>seps是一个数组，保存了每次分割时的分隔符。</p>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split(&quot;abc-def-gho-pq&quot;,arr,&quot;-&quot;,seps)</span><br></pre></td></tr></table></figure>
<p>其返回值为4。同时得到的数组a和seps为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">arr[1] = &quot;abc&quot;</span><br><span class="line">arr[2] = &quot;def&quot;</span><br><span class="line">arr[3] = &quot;gho&quot;</span><br><span class="line">arr[4] = &quot;pq&quot;</span><br><span class="line"></span><br><span class="line">seps[1] = &quot;-&quot;</span><br><span class="line">seps[2] = &quot;-&quot;</span><br><span class="line">seps[3] = &quot;-&quot;</span><br></pre></td></tr></table></figure>
<p>split在开始工作时，会先清空数组，所以，将split的string参数设置为空，可以用于清空数组。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;arr[1]=1;split(&quot;&quot;,arr);print length(arr)&#125;&#x27;  # 0</span><br></pre></td></tr></table></figure>
<p>如果分隔符无法匹配字符串，则整个字符串当作一个数组元素保存到数组array中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;split(&quot;abcde&quot;,arr,&quot;-&quot;);print arr[1]&#125;&#x27; # abcde</span><br></pre></td></tr></table></figure>
<ul>
<li><code>patsplit(string, array [, fieldpat [, seps ] ])</code>：用正则表达式fieldpat匹配字符串string，将所有匹配成功的部分保存到数组array中，数组索引从1开始存储。返回值是array的元素个数，即匹配成功了多少次</li>
</ul>
<p>如果省略fieldpat，则默认采用预定义变量FPAT的值。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        patsplit(&quot;abcde&quot;,arr,&quot;[a-z]&quot;)</span><br><span class="line">        print arr[1]   # a</span><br><span class="line">        print arr[2]   # b</span><br><span class="line">        print arr[3]   # c</span><br><span class="line">        print arr[4]   # d</span><br><span class="line">        print arr[5]   # e</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="（4）awk-match">（4）awk match()</h4>
<ul>
<li><code>match(string,reg[,arr])</code>：使用reg匹配string，返回匹配成功的索引位(从1开始计数)，匹配失败则返回0。如果指定了arr参数，则arr[0]保存的是匹配成功的字符串，arr[1]、arr[2]、…保存的是各个分组捕获的内容</li>
</ul>
<p>match匹配时，同时会设置两个预定义变量：RSTART和RLENGTH</p>
<ul>
<li>匹配成功时：
<ul>
<li>RSTART赋值为匹配成功的索引位，从1开始计数</li>
<li>RLENGTH赋值为匹配成功的字符长度</li>
</ul>
</li>
<li>匹配失败时：
<ul>
<li>RSTART赋值为0</li>
<li>RLENGTH赋值为-1</li>
</ul>
</li>
</ul>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        where = match(&quot;foooobazbarrrr&quot;,&quot;(fo+).*(bar*)&quot;,arr)</span><br><span class="line">        print where   # 1</span><br><span class="line">        print arr[0]  # foooobazbarrrr</span><br><span class="line">        print arr[1]  # foooo</span><br><span class="line">        print arr[2]  # barrrr</span><br><span class="line">        print RSTART  # 1</span><br><span class="line">        print RLENGTH # 14</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>因为match()匹配成功时返回值为非0，而匹配失败时返回值为0，所以可以直接当作条件判断：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">  &#123;</span><br><span class="line">    if(match($0,/A[a-z]+/,arr))&#123;</span><br><span class="line">      print NR &quot; : &quot; arr[0]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#x27; a.txt</span><br></pre></td></tr></table></figure>
<h4 id="（5）awk-sub-和gsub">（5）awk sub()和gsub()</h4>
<ul>
<li><code>sub(regexp, replacement [, target])</code></li>
<li><code>gsub(regexp, replacement [, target])</code>：sub()的全局模式</li>
</ul>
<p>sub()从字符串target中进行正则匹配，并使用replacement对第一次匹配成功的部分进行替换，替换后保存回target中。返回替换成功的次数，即0或1。</p>
<p>target必须是一个可以赋值的变量名、$N或数组元素名，以便用它来保存替换成功后的结果。不能是字符串字面量，因为它无法保存数据。</p>
<p>如果省略target，则默认使用<code>$0</code>。</p>
<p>需要注意的是，如果省略target，或者target是<code>$N</code>，那么替换成功后将会使用OFS重新计算<code>$0</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        str=&quot;water water everywhere&quot;</span><br><span class="line">        #how_many = sub(/at/, &quot;ith&quot;, str)</span><br><span class="line">        how_many = gsub(/at/, &quot;ith&quot;, str)</span><br><span class="line">        print how_many   # 1</span><br><span class="line">        print str        # wither water everywhere</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>在replacement参数中，可以使用一个特殊的符号<code>&amp;</code>来引用匹配成功的部分。注意sub()和gsub()不能在replacement中使用反向引用<code>\N</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;</span><br><span class="line">    BEGIN&#123;</span><br><span class="line">        str = &quot;daabaaa&quot;</span><br><span class="line">        gsub(/a+/,&quot;C&amp;C&quot;,str)</span><br><span class="line">        print str  # dCaaCbaaa</span><br><span class="line">    &#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>
<p>如果想要在replacement中使用<code>&amp;</code>纯字符，则转义即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub(/a+/,&quot;C\\&amp;C&quot;,str)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>两根反斜线：<br>
因为awk在正则开始工作时，首先会扫描所有awk代码然后编译成awk的内部格式，扫描期间会解析反斜线转义，使得<code>\\</code>变成一根反斜线。当真正开始运行后，sub()又要解析，这时<code>\&amp;</code>才表示的是对&amp;做转义。<br>
扫描代码阶段称为词法解析阶段，运行解析阶段称为运行时解析阶段。</p>
</blockquote>
<h4 id="（6）awk-gensub">（6）awk gensub()</h4>
<p>gawk支持的gensub()，完全可以取代sub()和gsub()。</p>
<ul>
<li><code>gensub(regexp, replacement, how [, target])</code>：</li>
</ul>
<p>可以替代sub()和gsub()。</p>
<p>how指定替换第几个匹配，例如指定为1表示只替换第一个匹配。此外，还可以指定为<code>g</code>或<code>G</code>开头的字符串，表示全局替换。</p>
<p>gensub()返回替换后得到的结果，而target不变，如果匹配失败，则返回target。这和sub()、gsub()不一样，sub()、gsub()返回的是替换成功的次数。</p>
<p>gensub()的replacement部分可以使用<code>\N</code>来引用分组匹配的结果，而sub()、gsub()不允许使用反向引用。而且，gensub()在replacement部分也还可以使用<code>&amp;</code>或<code>\0</code>来表示匹配的整个结果。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;</span><br><span class="line">    a = &quot;abc def&quot;</span><br><span class="line">    b = gensub(/(.+) (.*)/, &quot;\\2 \\1, \\0 , &amp;&quot;, &quot;g&quot;, a)</span><br><span class="line">    print b  # def abc, abc def , abc def</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="（7）awk-asort-和asorti">（7）awk asort()和asorti()</h4>
<ul>
<li><code>asort(src,[dest [,how]])</code></li>
<li><code>asorti(src,[dest [,how]])</code></li>
</ul>
<p>asort对数组src的值进行排序，然后将排序后的值的索引改为1、2、3、4…序列。返回src中的元素个数，它可以当作排序后的索引最大值。</p>
<p>asorti对数组src的索引进行排序，然后将排序后的索引值的索引改为1、2、3、4…序列。返回src中的元素个数，它可以当作排序后的索引最大值。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr[&quot;last&quot;] = &quot;de&quot;</span><br><span class="line">arr[&quot;first&quot;] = &quot;sac&quot;</span><br><span class="line">arr[&quot;middle&quot;] = &quot;cul&quot;</span><br></pre></td></tr></table></figure>
<p>asort(arr)得到：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr[1] = &quot;cul&quot;</span><br><span class="line">arr[2] = &quot;de&quot;</span><br><span class="line">arr[3] = &quot;sac&quot;</span><br></pre></td></tr></table></figure>
<p>asorti(arr)得到：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr[1] = &quot;first&quot;</span><br><span class="line">arr[2] = &quot;last&quot;</span><br><span class="line">arr[3] = &quot;middle&quot;</span><br></pre></td></tr></table></figure>
<p>如果指定dest，则将原始数组src备份到dest，然后对dest进行排序，而src保持不变。</p>
<p>how参数用于指定排序时的方式，其值指定方式和<code>PROCINFO[&quot;sorted_in&quot;]</code>一致：可以是预定义的排序函数，也可以是用户自定义的排序函数。</p>
<h2 id="参考链接🌹">参考链接🌹</h2>
<p><strong>感谢以下大佬文章的支持。</strong></p>
<p>1️⃣ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/doushi/article/details/74332099">在awk中正确使用close避免文件句柄泄露</a></p>
<p>2️⃣<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.junmajinlong.com/shell/awk/index/">精通awk系列文章 | 骏马金龙 (junmajinlong.com)</a></p>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Linux三剑客系列之awk</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.yyds.space/posts/626e4dad2867.html">https://www.yyds.space/posts/626e4dad2867.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>YYDS Space</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2022-05-31</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2023-03-26</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener external nofollow noreferrer" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener external nofollow noreferrer" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>Linux</a><a class="post-meta__tags" href="/tags/%E4%B8%89%E5%89%91%E5%AE%A2/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>三剑客</a><a class="post-meta__tags" href="/tags/Linux%E4%B8%89%E5%89%91%E5%AE%A2/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>Linux三剑客</a><a class="post-meta__tags" href="/tags/awk/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>awk</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.niux.plus/LightPicture/2023/02/341dff4125857b97.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/02/341dff4125857b97.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.niux.plus/LightPicture/2023/02/d2f65b4e3b5f3fd3.png" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/02/d2f65b4e3b5f3fd3.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/714fa0549b18.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/01/a0aba453bbd90d5d.png" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux三剑客系列之grep</div></div></a></div><div class="next-post pull-right"><a href="/posts/71ac2d6e5ae8.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/01/7bffc4340863cc4a.png" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux三剑客系列之sed</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/714fa0549b18.html" title="Linux三剑客系列之grep"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/01/a0aba453bbd90d5d.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-26</div><div class="title">Linux三剑客系列之grep</div></div></a></div><div><a href="/posts/71ac2d6e5ae8.html" title="Linux三剑客系列之sed"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/01/7bffc4340863cc4a.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-26</div><div class="title">Linux三剑客系列之sed</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%F0%9F%8D%89"><span class="toc-text">准备工作🍉</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81awk%E7%94%A8%E6%B3%95%E5%85%A5%E9%97%A8%F0%9F%8D%85"><span class="toc-text">一、awk用法入门🍅</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81BEGIN-%E5%92%8C-END-%E8%AF%AD%E5%8F%A5%E5%9D%97%F0%9F%A5%95"><span class="toc-text">二、BEGIN 和 END 语句块🥕</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81awk%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BB%93%E6%9E%84%E5%92%8Cawk%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84%F0%9F%8C%BD"><span class="toc-text">三、awk命令行结构和awk语法结构🌽</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81awk%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BB%93%E6%9E%84"><span class="toc-text">1、awk命令行结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81awk%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-text">2、awk语法结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81pattern-%E5%92%8C-action"><span class="toc-text">3、pattern 和 action</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81awk-%E9%80%89%E9%A1%B9%E3%80%81%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F%F0%9F%A5%A6"><span class="toc-text">四、awk 选项、预定义变量🥦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%80%89%E9%A1%B9"><span class="toc-text">1、选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-text">2、预定义变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81awk-%E8%AF%BB%E5%8F%96%E8%A1%8C%F0%9F%8D%84"><span class="toc-text">五、awk 读取行🍄</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90-awk-%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-text">1、详细分析 awk 如何读取文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%A4%E7%A7%8D%E8%A1%8C%E5%8F%B7%EF%BC%9ANR%E5%92%8CFNR"><span class="toc-text">2、两种行号：NR和FNR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81-0%E9%87%8D%E6%9E%84-1-1"><span class="toc-text">3、$0重构 -&gt; $1&#x3D;$1</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90awk%E5%AD%97%E6%AE%B5%E5%88%86%E5%89%B2%F0%9F%90%BC"><span class="toc-text">六、详细分析awk字段分割🐼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%BC%95%E7%94%A8%E5%AD%97%E6%AE%B5%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">1、引用字段的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%86%E5%89%B2%E5%AD%97%E6%AE%B5%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">2、分割字段的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%88%92%E5%88%86%E5%AD%97%E6%AE%B5%E6%96%B9%E5%BC%8F-%E4%B8%80-%EF%BC%9AFS%E6%88%96-F"><span class="toc-text">（1）划分字段方式(一)：FS或-F</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%88%92%E5%88%86%E5%AD%97%E6%AE%B5%E6%96%B9%E5%BC%8F-%E4%BA%8C-%EF%BC%9AFIELDWIDTHS%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%8Cgawk%E6%94%AF%E6%8C%81%EF%BC%89"><span class="toc-text">（2）划分字段方式(二)：FIELDWIDTHS（了解，gawk支持）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%88%92%E5%88%86%E5%AD%97%E6%AE%B5%E6%96%B9%E5%BC%8F-%E4%B8%89-%EF%BC%9AFPAT%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%8Cgawk%E6%94%AF%E6%8C%81%EF%BC%89"><span class="toc-text">（3）划分字段方式(三)：FPAT（了解，gawk支持）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81awk%E7%AD%9B%E9%80%89%E8%A1%8C%E5%92%8C%E5%A4%84%E7%90%86%E5%AD%97%E6%AE%B5%F0%9F%A6%89"><span class="toc-text">七、awk筛选行和处理字段🦉</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AD%9B%E9%80%89%E8%A1%8C"><span class="toc-text">1、筛选行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%A4%84%E7%90%86%E5%AD%97%E6%AE%B5"><span class="toc-text">2、处理字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E6%B5%8B%E8%AF%95%EF%BC%9Aawk%E8%BF%90%E7%BB%B4%E9%9D%A2%E8%AF%95%E8%AF%95%E9%A2%98"><span class="toc-text">小测试：awk运维面试试题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81awk-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%F0%9F%90%A7"><span class="toc-text">八、awk 工作流程🐧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81getline-%E7%94%A8%E6%B3%95%E8%AF%A6%E8%A7%A3%F0%9F%90%B2"><span class="toc-text">九、getline 用法详解🐲</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%97%A0%E5%8F%82%E6%95%B0%E7%9A%84-getline"><span class="toc-text">1、无参数的 getline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84getline"><span class="toc-text">2、一个参数的getline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BB%8E%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text">3、从指定文件中读取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E4%BB%8EShell%E5%91%BD%E4%BB%A4%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text">4、从Shell命令输出结果中读取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81awk%E4%B8%AD%E7%9A%84coprocess"><span class="toc-text">5、awk中的coprocess</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81awk-%E8%BE%93%E5%87%BA%E6%93%8D%E4%BD%9C%F0%9F%90%B8"><span class="toc-text">十、awk 输出操作🐸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81print"><span class="toc-text">1、print</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#print%E8%BE%93%E5%87%BA%E6%95%B0%E5%80%BC"><span class="toc-text">print输出数值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81printf"><span class="toc-text">2、printf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81sprintf"><span class="toc-text">3、sprintf()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81stdin%E3%80%81stdout%E3%80%81stderr"><span class="toc-text">4、stdin、stdout、stderr</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81close-%E5%85%B3%E9%97%AD%E5%8F%A5%E6%9F%84%F0%9F%90%B3"><span class="toc-text">十一、close 关闭句柄🐳</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81awk-%E5%8F%98%E9%87%8F%F0%9F%90%8B"><span class="toc-text">十二、awk 变量🐋</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC"><span class="toc-text">1、变量赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81awk%E4%B8%AD%E5%A3%B0%E6%98%8E%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-text">2、awk中声明变量的位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81awk-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%F0%9F%90%AC"><span class="toc-text">十三、awk 流程控制🐬</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81if%E2%80%A6else"><span class="toc-text">1、if…else</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">2、三目运算符?:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81switch%E2%80%A6case"><span class="toc-text">3、switch…case</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81while%E5%92%8Cdo%E2%80%A6while"><span class="toc-text">4、while和do…while</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81for%E5%BE%AA%E7%8E%AF"><span class="toc-text">5、for循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81break%E5%92%8Ccontinue"><span class="toc-text">6、break和continue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81next%E5%92%8Cnextfile"><span class="toc-text">7、next和nextfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81exit"><span class="toc-text">8、exit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E6%95%B0%E7%BB%84%F0%9F%90%9F"><span class="toc-text">十四、数组🐟</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81awk%E8%AE%BF%E9%97%AE%E3%80%81%E8%B5%8B%E5%80%BC%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0"><span class="toc-text">1、awk访问、赋值数组元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81awk%E6%95%B0%E7%BB%84%E9%95%BF%E5%BA%A6"><span class="toc-text">2、awk数组长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81awk%E5%88%A0%E9%99%A4%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0"><span class="toc-text">3、awk删除数组元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81awk%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%98%AF%E6%95%B0%E7%BB%84"><span class="toc-text">4、awk检测是否是数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81awk%E6%B5%8B%E8%AF%95%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%9C%A8%E6%95%B0%E7%BB%84%E4%B8%AD"><span class="toc-text">5、awk测试元素是否在数组中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81awk%E9%81%8D%E5%8E%86%E6%95%B0%E7%BB%84"><span class="toc-text">6、awk遍历数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81awk-%E5%AD%90%E6%95%B0%E7%BB%84"><span class="toc-text">7、awk 子数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81awk%E6%8C%87%E5%AE%9A%E6%95%B0%E7%BB%84%E9%81%8D%E5%8E%86%E9%A1%BA%E5%BA%8F"><span class="toc-text">8、awk指定数组遍历顺序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%94%E3%80%81awk-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%F0%9F%90%A0"><span class="toc-text">十五、awk 自定义函数🐠</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="toc-text">1、函数定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81awk%E5%87%BD%E6%95%B0%E7%9A%84return%E8%AF%AD%E5%8F%A5"><span class="toc-text">2、awk函数的return语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81awk%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="toc-text">3、awk函数参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81awk%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98"><span class="toc-text">4、awk函数参数数据类型冲突问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81awk%E5%8F%82%E6%95%B0%E6%8C%89%E5%80%BC%E4%BC%A0%E9%80%92%E8%BF%98%E6%98%AF%E6%8C%89%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92"><span class="toc-text">5、awk参数按值传递还是按引用传递</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81awk%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-text">6、awk作用域问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E3%80%81awk%E6%95%B0%E5%80%BC%E7%B1%BB%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%F0%9F%8C%B3"><span class="toc-text">十六、awk数值类内置函数🌳</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81awk%E6%95%B0%E5%80%BC%E7%B1%BB%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-text">1、awk数值类内置函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81awk%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-text">2、awk字符串类内置函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="toc-text">（1）基本函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89awk-substr"><span class="toc-text">（2）awk substr()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89awk-split-%E5%92%8Cpatsplit"><span class="toc-text">（3）awk split()和patsplit()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89awk-match"><span class="toc-text">（4）awk match()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%885%EF%BC%89awk-sub-%E5%92%8Cgsub"><span class="toc-text">（5）awk sub()和gsub()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%886%EF%BC%89awk-gensub"><span class="toc-text">（6）awk gensub()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%887%EF%BC%89awk-asort-%E5%92%8Casorti"><span class="toc-text">（7）awk asort()和asorti()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5%F0%9F%8C%B9"><span class="toc-text">参考链接🌹</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener external nofollow noreferrer" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/site/echarts/">网站统计</a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://gpt.yyds.space">YYDS GPT</a></li><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/personal/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/personal/time/">建设进程</a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.fomal.cc/posts/eec9786.html">魔改指南</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.leonus.cn/" title="Leonus"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://q1.qlogo.cn/g?b=qq&amp;nk=990320751&amp;s=5" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.fomal.cc/" title="Fomalhaut🥝"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.fomal.cc/assets/avatar.webp" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://fe32.top/" title="Ethan.Tzy"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/05/02/626f92e193879.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://akilar.top/" title="Akilarの糖果屋"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/akilar-friends@latest/avatar/akilar.top.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/zh-cn/" title="hexo"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://d33wubrfki0l68.cloudfront.net/6657ba50e702d84afb32fe846bed54fba1a77add/827ae/logo.svg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.zhheo.com/" title="张洪Heo"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://bu.dusays.com/2022/12/28/63ac2812183aa.png" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.eurkon.com" title="Eurkon"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog.eurkon.com/images/user/avatar.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.qcqx.cn" title="轻笑Chuckle"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.qcqx.cn/img/head.webp" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2021-2023</b></span><span><b>&nbsp;&nbsp;By YYDS Space</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" rel="external nofollow noreferrer" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站数据分析得益于51la技术支持"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站已加入ICP备案，京ICP备2021018172号-3"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/blog/img/beian.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20239986" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20239986号"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/blog/img/meng.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Copyright-BY--NC--SA--4.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();" rel="external nofollow noreferrer"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();" rel="external nofollow noreferrer"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();" rel="external nofollow noreferrer"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()" rel="external nofollow noreferrer"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()" rel="external nofollow noreferrer"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()" rel="external nofollow noreferrer"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()" rel="external nofollow noreferrer"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()" rel="external nofollow noreferrer"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();" rel="external nofollow noreferrer"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();" rel="external nofollow noreferrer"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();" rel="external nofollow noreferrer"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();" rel="external nofollow noreferrer"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.yyds.space/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.yyds.space/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script>let tianliGPT_postSelector = '\#post \#article-container';let tianliGPT_key = 'Bw2Cs74EtAeqvMX009rO';</script><script src="/js/ai.js"></script><script src="/js/jquery-latest.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="//at.alicdn.com/t/c/font_3874817_oq0w2btaabs.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/3ba5dfdb58f4.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/01/a0aba453bbd90d5d.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-02-14</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/3ba5dfdb58f4.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">每日 60S 早报</a><div class="blog-slider__text">🧭 每日 60 秒，读懂世界</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/3ba5dfdb58f4.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/4280e887a011.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.niux.plus/LightPicture/2023/01/f5452888ae734a67.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-02-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/4280e887a011.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">Markdown语法与外挂标签写法汇总</a><div class="blog-slider__text">🥧本文汇总Markdown格式以及外挂标签在网页端的渲染效果，可作为文档进行查询</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/4280e887a011.html&quot;);" href="javascript:void(0);" rel="external nofollow noreferrer" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    // console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>